<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pirate Ship Battle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes wave {
            0% { transform: translateX(0) translateY(0); }
            50% { transform: translateX(50px) translateY(10px); }
            100% { transform: translateX(0) translateY(0); }
        }
        
        @keyframes shipRock {
            0% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
            100% { transform: rotate(-5deg); }
        }
        
        @keyframes explosion {
            0% { transform: scale(0.5); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        @keyframes rain {
            0% { background-position: 0 0; }
            100% { background-position: 0 50px; }
        }
        
        .wave-animation {
            animation: wave 8s infinite ease-in-out;
        }
        
        .ship-rocking {
            animation: shipRock 4s infinite ease-in-out;
        }
        
        .explosion {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #ff6600, #ff0000);
            border-radius: 50%;
            animation: explosion 0.5s forwards;
            pointer-events: none;
        }
        
        .rain-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(transparent, transparent 45%, rgba(255, 255, 255, 0.3) 50%, transparent 55%, transparent);
            background-size: 5px 5px;
            animation: rain 0.5s linear infinite;
            opacity: 0;
            pointer-events: none;
        }
        
        .fog-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(200, 200, 200, 0.3);
            pointer-events: none;
        }
        
        .health-bar {
            transition: width 0.3s ease;
        }
        
        .cannon-ball {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #000;
            border-radius: 50%;
            pointer-events: none;
        }
        
        .splash {
            position: absolute;
            width: 30px;
            height: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            pointer-events: none;
            animation: fadeOut 1s forwards;
        }
        
        @keyframes fadeOut {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(1.5); }
        }
        
        .damage-text {
            position: absolute;
            color: red;
            font-weight: bold;
            animation: floatUp 1s forwards;
            pointer-events: none;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }
    </style>
</head>
<body class="bg-blue-900 overflow-hidden h-screen flex flex-col">
    <!-- Game Title -->
    <div class="text-center py-4 bg-blue-800 text-white shadow-lg">
        <h1 class="text-3xl font-bold">Pirate Ship Battle</h1>
        <p class="text-yellow-300">Command your ship and conquer the seas!</p>
    </div>
    
    <!-- Game Stats -->
    <div class="flex justify-between px-4 py-2 bg-blue-700 text-white">
        <div class="flex items-center space-x-4">
            <div>
                <span class="font-bold">Gold:</span> <span id="gold">100</span> <i class="fas fa-coins text-yellow-400"></i>
            </div>
            <div>
                <span class="font-bold">Kills:</span> <span id="kills">0</span> <i class="fas fa-skull text-gray-300"></i>
            </div>
        </div>
        <div>
            <button id="pause-btn" class="bg-yellow-600 hover:bg-yellow-700 px-3 py-1 rounded">
                <i class="fas fa-pause"></i> Pause
            </button>
        </div>
    </div>
    
    <!-- Game Area -->
    <div id="game-container" class="flex-1 relative overflow-hidden">
        <!-- Weather effects will be added here dynamically -->
        <div id="weather-effects"></div>
        
        <!-- Ocean background with waves -->
        <div class="absolute inset-0 bg-blue-600 overflow-hidden">
            <div class="absolute bottom-0 w-full h-32 bg-blue-500 wave-animation"></div>
            <div class="absolute bottom-0 w-full h-24 bg-blue-400 wave-animation" style="animation-delay: 0.5s;"></div>
        </div>
        
        <!-- Player Ship -->
        <div id="player-ship" class="absolute bottom-20 left-1/4 w-32 h-32 ship-rocking">
            <div class="relative w-full h-full">
                <div class="absolute bottom-0 w-full h-16 bg-brown-800 bg-[#8B4513] rounded-t-full"></div>
                <div class="absolute bottom-16 left-1/2 transform -translate-x-1/2 w-2 h-24 bg-[#5D4037]"></div>
                <div class="absolute bottom-28 left-1/2 transform -translate-x-1/2 w-24 h-4 bg-[#795548]"></div>
                <div class="absolute bottom-16 left-1/4 w-6 h-6 bg-[#5D4037] rounded-full"></div>
                <div class="absolute bottom-16 right-1/4 w-6 h-6 bg-[#5D4037] rounded-full"></div>
                <div class="absolute bottom-0 left-1/4 w-8 h-4 bg-[#5D4037]"></div>
                <div class="absolute bottom-0 right-1/4 w-8 h-4 bg-[#5D4037]"></div>
                <img src="https://cdn-icons-png.flaticon.com/512/477/477103.png" class="absolute bottom-24 left-1/2 transform -translate-x-1/2 w-8 h-8">
            </div>
            
            <!-- Player Ship Stats -->
            <div class="absolute -top-8 left-0 right-0 text-center">
                <div class="inline-block bg-black bg-opacity-50 text-white px-2 py-1 rounded">
                    <div class="flex items-center">
                        <span class="mr-2">HP:</span>
                        <div class="w-20 h-2 bg-gray-300 rounded">
                            <div id="player-health" class="health-bar h-full bg-green-500 rounded" style="width: 100%;"></div>
                        </div>
                    </div>
                    <div class="flex items-center mt-1">
                        <span class="mr-2">Crew:</span>
                        <div class="w-20 h-2 bg-gray-300 rounded">
                            <div id="player-crew" class="health-bar h-full bg-blue-400 rounded" style="width: 100%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Enemy Ships Container -->
        <div id="enemy-ships" class="absolute inset-0"></div>
        
        <!-- Projectiles Container -->
        <div id="projectiles" class="absolute inset-0"></div>
        
        <!-- Effects Container -->
        <div id="effects" class="absolute inset-0"></div>
    </div>
    
    <!-- Controls -->
    <div class="bg-blue-800 p-4 flex justify-between items-center">
        <div class="flex space-x-4">
            <button id="move-left" class="bg-blue-600 hover:bg-blue-700 w-12 h-12 rounded-full flex items-center justify-center">
                <i class="fas fa-arrow-left text-white text-xl"></i>
            </button>
            <button id="move-right" class="bg-blue-600 hover:bg-blue-700 w-12 h-12 rounded-full flex items-center justify-center">
                <i class="fas fa-arrow-right text-white text-xl"></i>
            </button>
        </div>
        
        <div class="flex space-x-4">
            <button id="fire-left" class="bg-red-600 hover:bg-red-700 w-12 h-12 rounded-full flex items-center justify-center">
                <i class="fas fa-fire text-white text-xl"></i> L
            </button>
            <button id="fire-right" class="bg-red-600 hover:bg-red-700 w-12 h-12 rounded-full flex items-center justify-center">
                <i class="fas fa-fire text-white text-xl"></i> R
            </button>
        </div>
        
        <div class="flex space-x-4">
            <button id="repair" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded flex items-center">
                <i class="fas fa-tools mr-2"></i> Repair (50g)
            </button>
            <button id="recruit" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded flex items-center">
                <i class="fas fa-users mr-2"></i> Recruit (30g)
            </button>
        </div>
    </div>
    
    <!-- Game Messages -->
    <div id="game-message" class="absolute top-1/2 left-0 right-0 transform -translate-y-1/2 text-center text-white text-2xl font-bold pointer-events-none opacity-0 transition-opacity duration-300"></div>
    
    <!-- Pause Menu -->
    <div id="pause-menu" class="absolute inset-0 bg-black bg-opacity-70 flex flex-col items-center justify-center hidden">
        <div class="bg-blue-800 p-8 rounded-lg max-w-md w-full text-white">
            <h2 class="text-3xl font-bold mb-4 text-center">Game Paused</h2>
            <div class="mb-6">
                <h3 class="text-xl font-semibold mb-2">Game Stats</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p>Gold: <span id="pause-gold" class="text-yellow-400">0</span></p>
                        <p>Kills: <span id="pause-kills" class="text-red-400">0</span></p>
                    </div>
                    <div>
                        <p>Ship Health: <span id="pause-health" class="text-green-400">100%</span></p>
                        <p>Crew Health: <span id="pause-crew" class="text-blue-400">100%</span></p>
                    </div>
                </div>
            </div>
            <div class="flex flex-col space-y-4">
                <button id="resume-btn" class="bg-green-600 hover:bg-green-700 py-2 rounded">
                    <i class="fas fa-play mr-2"></i> Resume Game
                </button>
                <button id="restart-btn" class="bg-yellow-600 hover:bg-yellow-700 py-2 rounded">
                    <i class="fas fa-redo mr-2"></i> Restart Game
                </button>
                <button id="quit-btn" class="bg-red-600 hover:bg-red-700 py-2 rounded">
                    <i class="fas fa-times mr-2"></i> Quit Game
                </button>
            </div>
        </div>
    </div>
    
    <!-- Game Over Screen -->
    <div id="game-over" class="absolute inset-0 bg-black bg-opacity-70 flex flex-col items-center justify-center hidden">
        <div class="bg-blue-800 p-8 rounded-lg max-w-md w-full text-white">
            <h2 class="text-3xl font-bold mb-4 text-center text-red-500">Game Over</h2>
            <div class="mb-6 text-center">
                <p class="text-xl mb-2">Your pirate ship has been destroyed!</p>
                <div class="grid grid-cols-2 gap-4 mt-4">
                    <div>
                        <p>Total Gold: <span id="final-gold" class="text-yellow-400">0</span></p>
                        <p>Enemies Sunk: <span id="final-kills" class="text-red-400">0</span></p>
                    </div>
                    <div>
                        <p>Final Ship: <span id="final-health" class="text-green-400">0%</span></p>
                        <p>Final Crew: <span id="final-crew" class="text-blue-400">0%</span></p>
                    </div>
                </div>
            </div>
            <div class="flex flex-col space-y-4">
                <button id="play-again-btn" class="bg-green-600 hover:bg-green-700 py-2 rounded">
                    <i class="fas fa-redo mr-2"></i> Play Again
                </button>
                <button id="quit-game-btn" class="bg-red-600 hover:bg-red-700 py-2 rounded">
                    <i class="fas fa-times mr-2"></i> Quit
                </button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            gold: 100,
            kills: 0,
            playerHealth: 100,
            playerCrew: 100,
            gameSpeed: 1,
            isPaused: false,
            isGameOver: false,
            weather: 'clear',
            weatherTimer: 0,
            enemySpawnTimer: 0,
            enemySpawnInterval: 3000,
            lastTime: 0,
            playerPosition: 25, // percentage from left
            playerSpeed: 0.5,
            leftCannonCooldown: 0,
            rightCannonCooldown: 0,
            cannonCooldownTime: 1000,
            enemies: [],
            projectiles: [],
            effects: []
        };

        // DOM Elements
        const gameContainer = document.getElementById('game-container');
        const playerShip = document.getElementById('player-ship');
        const enemyShipsContainer = document.getElementById('enemy-ships');
        const projectilesContainer = document.getElementById('projectiles');
        const effectsContainer = document.getElementById('effects');
        const weatherEffectsContainer = document.getElementById('weather-effects');
        const gameMessage = document.getElementById('game-message');
        const pauseMenu = document.getElementById('pause-menu');
        const gameOverScreen = document.getElementById('game-over');
        
        // Stats Elements
        const goldElement = document.getElementById('gold');
        const killsElement = document.getElementById('kills');
        const playerHealthElement = document.getElementById('player-health');
        const playerCrewElement = document.getElementById('player-crew');
        
        // Control Buttons
        const moveLeftBtn = document.getElementById('move-left');
        const moveRightBtn = document.getElementById('move-right');
        const fireLeftBtn = document.getElementById('fire-left');
        const fireRightBtn = document.getElementById('fire-right');
        const repairBtn = document.getElementById('repair');
        const recruitBtn = document.getElementById('recruit');
        const pauseBtn = document.getElementById('pause-btn');
        const resumeBtn = document.getElementById('resume-btn');
        const restartBtn = document.getElementById('restart-btn');
        const quitBtn = document.getElementById('quit-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const quitGameBtn = document.getElementById('quit-game-btn');
        
        // Game Dimensions
        const gameWidth = gameContainer.offsetWidth;
        const gameHeight = gameContainer.offsetHeight;
        
        // Event Listeners
        moveLeftBtn.addEventListener('mousedown', () => movePlayer('left'));
        moveLeftBtn.addEventListener('touchstart', () => movePlayer('left'));
        moveRightBtn.addEventListener('mousedown', () => movePlayer('right'));
        moveRightBtn.addEventListener('touchstart', () => movePlayer('right'));
        
        moveLeftBtn.addEventListener('mouseup', stopPlayer);
        moveLeftBtn.addEventListener('touchend', stopPlayer);
        moveRightBtn.addEventListener('mouseup', stopPlayer);
        moveRightBtn.addEventListener('touchend', stopPlayer);
        
        fireLeftBtn.addEventListener('click', () => fireCannon('left'));
        fireRightBtn.addEventListener('click', () => fireCannon('right'));
        
        repairBtn.addEventListener('click', repairShip);
        recruitBtn.addEventListener('click', recruitCrew);
        
        pauseBtn.addEventListener('click', togglePause);
        resumeBtn.addEventListener('click', togglePause);
        restartBtn.addEventListener('click', restartGame);
        quitBtn.addEventListener('click', quitGame);
        playAgainBtn.addEventListener('click', restartGame);
        quitGameBtn.addEventListener('click', quitGame);
        
        // Keyboard Controls
        document.addEventListener('keydown', (e) => {
            if (gameState.isPaused || gameState.isGameOver) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    movePlayer('left');
                    break;
                case 'ArrowRight':
                    movePlayer('right');
                    break;
                case 'a':
                case 'A':
                    fireCannon('left');
                    break;
                case 'd':
                case 'D':
                    fireCannon('right');
                    break;
                case 'r':
                case 'R':
                    repairShip();
                    break;
                case 'c':
                case 'C':
                    recruitCrew();
                    break;
                case ' ':
                case 'Escape':
                    togglePause();
                    break;
            }
        });
        
        document.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                stopPlayer();
            }
        });
        
        // Game Functions
        function movePlayer(direction) {
            if (gameState.isPaused || gameState.isGameOver) return;
            
            if (direction === 'left') {
                gameState.playerSpeed = -0.5;
            } else if (direction === 'right') {
                gameState.playerSpeed = 0.5;
            }
        }
        
        function stopPlayer() {
            gameState.playerSpeed = 0;
        }
        
        function fireCannon(side) {
            if (gameState.isPaused || gameState.isGameOver) return;
            
            // Check cooldown
            if (side === 'left' && gameState.leftCannonCooldown > 0) return;
            if (side === 'right' && gameState.rightCannonCooldown > 0) return;
            
            // Set cooldown
            if (side === 'left') {
                gameState.leftCannonCooldown = gameState.cannonCooldownTime;
            } else {
                gameState.rightCannonCooldown = gameState.cannonCooldownTime;
            }
            
            // Create projectile
            const projectile = document.createElement('div');
            projectile.className = 'cannon-ball';
            
            // Position based on side
            const shipRect = playerShip.getBoundingClientRect();
            const containerRect = gameContainer.getBoundingClientRect();
            
            let x, y;
            if (side === 'left') {
                x = shipRect.left - containerRect.left + 20;
            } else {
                x = shipRect.right - containerRect.left - 20;
            }
            y = shipRect.top - containerRect.top + 30;
            
            projectile.style.left = `${x}px`;
            projectile.style.top = `${y}px`;
            
            projectilesContainer.appendChild(projectile);
            
            gameState.projectiles.push({
                element: projectile,
                x: x,
                y: y,
                speedX: side === 'left' ? -10 : 10,
                speedY: -5,
                gravity: 0.2,
                side: side
            });
            
            // Add recoil effect
            if (side === 'left') {
                playerShip.style.transform = 'translateX(-5px) rotate(-5deg)';
            } else {
                playerShip.style.transform = 'translateX(5px) rotate(5deg)';
            }
            
            setTimeout(() => {
                playerShip.style.transform = '';
            }, 200);
            
            // Play sound (would be added with Howler.js in a real game)
        }
        
        function repairShip() {
            if (gameState.isPaused || gameState.isGameOver) return;
            if (gameState.gold < 50) {
                showMessage("Not enough gold!", "red");
                return;
            }
            
            const healAmount = 30;
            if (gameState.playerHealth >= 100) {
                showMessage("Ship already at full health!", "yellow");
                return;
            }
            
            gameState.gold -= 50;
            gameState.playerHealth = Math.min(100, gameState.playerHealth + healAmount);
            updateStats();
            
            showMessage(`Ship repaired +${healAmount} HP!`, "green");
            
            // Healing effect
            const healEffect = document.createElement('div');
            healEffect.className = 'absolute bg-green-500 bg-opacity-30 rounded-full';
            healEffect.style.width = '100px';
            healEffect.style.height = '100px';
            healEffect.style.left = '50%';
            healEffect.style.top = '50%';
            healEffect.style.transform = 'translate(-50%, -50%)';
            healEffect.style.animation = 'fadeOut 1s forwards';
            
            playerShip.appendChild(healEffect);
            
            setTimeout(() => {
                healEffect.remove();
            }, 1000);
        }
        
        function recruitCrew() {
            if (gameState.isPaused || gameState.isGameOver) return;
            if (gameState.gold < 30) {
                showMessage("Not enough gold!", "red");
                return;
            }
            
            const recruitAmount = 20;
            if (gameState.playerCrew >= 100) {
                showMessage("Crew already at full strength!", "yellow");
                return;
            }
            
            gameState.gold -= 30;
            gameState.playerCrew = Math.min(100, gameState.playerCrew + recruitAmount);
            updateStats();
            
            showMessage(`Recruited +${recruitAmount} crew!`, "blue");
            
            // Crew effect
            for (let i = 0; i < 5; i++) {
                const crewMember = document.createElement('div');
                crewMember.className = 'absolute bg-blue-500 rounded-full';
                crewMember.style.width = '10px';
                crewMember.style.height = '10px';
                crewMember.style.left = `${Math.random() * 30 + 35}%`;
                crewMember.style.bottom = `${Math.random() * 20 + 10}px`;
                crewMember.style.animation = 'floatUp 1s forwards';
                
                playerShip.appendChild(crewMember);
                
                setTimeout(() => {
                    crewMember.remove();
                }, 1000);
            }
        }
        
        function createEnemy() {
            if (gameState.isPaused || gameState.isGameOver) return;
            
            const enemy = document.createElement('div');
            enemy.className = 'absolute bottom-20 w-32 h-32 ship-rocking';
            
            // Random type (small, medium, large)
            const type = Math.random() > 0.7 ? 'large' : (Math.random() > 0.5 ? 'medium' : 'small');
            let health, speed, goldReward;
            
            switch(type) {
                case 'small':
                    health = 40;
                    speed = 2;
                    goldReward = 20;
                    enemy.style.width = '24px';
                    enemy.style.height = '24px';
                    break;
                case 'medium':
                    health = 70;
                    speed = 1.5;
                    goldReward = 40;
                    enemy.style.width = '64px';
                    enemy.style.height = '64px';
                    break;
                case 'large':
                    health = 120;
                    speed = 1;
                    goldReward = 70;
                    enemy.style.width = '96px';
                    enemy.style.height = '96px';
                    break;
            }
            
            // Random position (right side of screen)
            const x = gameWidth;
            const y = gameHeight - 100 - Math.random() * 100;
            
            enemy.style.left = `${x}px`;
            enemy.style.bottom = `${gameHeight - y}px`;
            
            // Enemy ship design
            enemy.innerHTML = `
                <div class="relative w-full h-full">
                    <div class="absolute bottom-0 w-full h-16 bg-[#8B4513] rounded-t-full"></div>
                    <div class="absolute bottom-16 left-1/2 transform -translate-x-1/2 w-2 h-24 bg-[#5D4037]"></div>
                    <div class="absolute bottom-28 left-1/2 transform -translate-x-1/2 w-24 h-4 bg-[#795548]"></div>
                    <div class="absolute bottom-16 left-1/4 w-6 h-6 bg-[#5D4037] rounded-full"></div>
                    <div class="absolute bottom-16 right-1/4 w-6 h-6 bg-[#5D4037] rounded-full"></div>
                    <div class="absolute bottom-0 left-1/4 w-8 h-4 bg-[#5D4037]"></div>
                    <div class="absolute bottom-0 right-1/4 w-8 h-4 bg-[#5D4037]"></div>
                    <img src="https://cdn-icons-png.flaticon.com/512/477/477103.png" class="absolute bottom-24 left-1/2 transform -translate-x-1/2 w-8 h-8">
                </div>
                <div class="absolute -top-8 left-0 right-0 text-center">
                    <div class="inline-block bg-black bg-opacity-50 text-white px-2 py-1 rounded">
                        <div class="flex items-center">
                            <span class="mr-2">HP:</span>
                            <div class="w-20 h-2 bg-gray-300 rounded">
                                <div class="health-bar h-full bg-red-500 rounded" style="width: 100%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            enemyShipsContainer.appendChild(enemy);
            
            gameState.enemies.push({
                element: enemy,
                x: x,
                y: y,
                speed: speed,
                health: health,
                maxHealth: health,
                type: type,
                goldReward: goldReward,
                fireTimer: 0,
                fireInterval: 2000 + Math.random() * 2000,
                healthBar: enemy.querySelector('.health-bar')
            });
        }
        
        function updatePlayerPosition() {
            gameState.playerPosition = Math.max(0, Math.min(100, gameState.playerPosition + gameState.playerSpeed * gameState.gameSpeed));
            
            const x = (gameWidth * gameState.playerPosition / 100) - (playerShip.offsetWidth / 2);
            playerShip.style.left = `${x}px`;
        }
        
        function updateProjectiles(timestamp, deltaTime) {
            for (let i = gameState.projectiles.length - 1; i >= 0; i--) {
                const projectile = gameState.projectiles[i];
                
                // Update position
                projectile.x += projectile.speedX * gameState.gameSpeed;
                projectile.y += projectile.speedY * gameState.gameSpeed;
                projectile.speedY += projectile.gravity * gameState.gameSpeed;
                
                // Update DOM
                projectile.element.style.left = `${projectile.x}px`;
                projectile.element.style.top = `${projectile.y}px`;
                
                // Check if out of bounds
                if (projectile.x < 0 || projectile.x > gameWidth || projectile.y > gameHeight) {
                    // Create splash effect if hitting water
                    if (projectile.y > gameHeight - 50) {
                        createSplash(projectile.x, gameHeight - 50);
                    }
                    
                    projectile.element.remove();
                    gameState.projectiles.splice(i, 1);
                    continue;
                }
                
                // Check collision with enemies (player projectiles)
                if (projectile.side === 'left' || projectile.side === 'right') {
                    for (let j = gameState.enemies.length - 1; j >= 0; j--) {
                        const enemy = gameState.enemies[j];
                        const enemyRect = enemy.element.getBoundingClientRect();
                        const containerRect = gameContainer.getBoundingClientRect();
                        
                        const projectileLeft = projectile.x;
                        const projectileTop = projectile.y;
                        
                        if (
                            projectileLeft > enemyRect.left - containerRect.left &&
                            projectileLeft < enemyRect.right - containerRect.left &&
                            projectileTop > enemyRect.top - containerRect.top &&
                            projectileTop < enemyRect.bottom - containerRect.top
                        ) {
                            // Hit enemy
                            const damage = 10 + Math.floor(Math.random() * 10);
                            enemy.health -= damage;
                            
                            // Update health bar
                            const healthPercent = (enemy.health / enemy.maxHealth) * 100;
                            enemy.healthBar.style.width = `${healthPercent}%`;
                            
                            // Create explosion
                            createExplosion(projectile.x, projectile.y);
                            
                            // Show damage text
                            createDamageText(projectile.x, projectile.y, damage);
                            
                            // Remove projectile
                            projectile.element.remove();
                            gameState.projectiles.splice(i, 1);
                            
                            // Check if enemy is destroyed
                            if (enemy.health <= 0) {
                                // Reward player
                                gameState.gold += enemy.goldReward;
                                gameState.kills++;
                                updateStats();
                                
                                // Create sinking effect
                                createSinkingEffect(enemy);
                                
                                // Remove enemy
                                enemy.element.remove();
                                gameState.enemies.splice(j, 1);
                                
                                showMessage(`Enemy sunk! +${enemy.goldReward}g`, "gold");
                            }
                            
                            break;
                        }
                    }
                }
            }
            
            // Update cannon cooldowns
            if (gameState.leftCannonCooldown > 0) {
                gameState.leftCannonCooldown -= deltaTime;
            }
            if (gameState.rightCannonCooldown > 0) {
                gameState.rightCannonCooldown -= deltaTime;
            }
        }
        
        function updateEnemies(timestamp, deltaTime) {
            for (let i = gameState.enemies.length - 1; i >= 0; i--) {
                const enemy = gameState.enemies[i];
                
                // Move enemy
                enemy.x -= enemy.speed * gameState.gameSpeed;
                enemy.element.style.left = `${enemy.x}px`;
                
                // Check if out of bounds
                if (enemy.x < -enemy.element.offsetWidth) {
                    enemy.element.remove();
                    gameState.enemies.splice(i, 1);
                    continue;
                }
                
                // Enemy firing logic
                enemy.fireTimer += deltaTime;
                if (enemy.fireTimer >= enemy.fireInterval) {
                    enemy.fireTimer = 0;
                    enemyFire(enemy);
                }
                
                // Check collision with player (for ramming damage)
                const playerRect = playerShip.getBoundingClientRect();
                const enemyRect = enemy.element.getBoundingClientRect();
                
                if (
                    playerRect.right > enemyRect.left &&
                    playerRect.left < enemyRect.right &&
                    playerRect.bottom > enemyRect.top &&
                    playerRect.top < enemyRect.bottom
                ) {
                    // Collision with player
                    const damage = 5 + Math.floor(Math.random() * 10);
                    takeDamage(damage);
                    
                    // Push player back
                    gameState.playerPosition = Math.max(0, gameState.playerPosition - 5);
                    
                    // Create explosion
                    const explosionX = (playerRect.left + enemyRect.left) / 2 - gameContainer.getBoundingClientRect().left;
                    const explosionY = (playerRect.top + enemyRect.top) / 2 - gameContainer.getBoundingClientRect().top;
                    createExplosion(explosionX, explosionY);
                    
                    // Show damage text
                    createDamageText(explosionX, explosionY, damage);
                    
                    // Remove enemy
                    enemy.element.remove();
                    gameState.enemies.splice(i, 1);
                    
                    showMessage(`Ramming damage! -${damage} HP`, "red");
                }
            }
        }
        
        function enemyFire(enemy) {
            if (gameState.isPaused || gameState.isGameOver) return;
            
            // Create projectile
            const projectile = document.createElement('div');
            projectile.className = 'cannon-ball';
            
            // Position at enemy ship
            const enemyRect = enemy.element.getBoundingClientRect();
            const containerRect = gameContainer.getBoundingClientRect();
            
            const x = enemyRect.left - containerRect.left + 10;
            const y = enemyRect.top - containerRect.top + 30;
            
            projectile.style.left = `${x}px`;
            projectile.style.top = `${y}px`;
            
            projectilesContainer.appendChild(projectile);
            
            // Calculate direction to player
            const playerRect = playerShip.getBoundingClientRect();
            const targetX = playerRect.left - containerRect.left + playerRect.width / 2;
            const targetY = playerRect.top - containerRect.top + playerRect.height / 2;
            
            const dx = targetX - x;
            const dy = targetY - y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            const speed = 5;
            const speedX = (dx / distance) * speed;
            const speedY = (dy / distance) * speed;
            
            gameState.projectiles.push({
                element: projectile,
                x: x,
                y: y,
                speedX: speedX,
                speedY: speedY,
                gravity: 0.1,
                side: 'enemy'
            });
            
            // Recoil effect
            enemy.element.style.transform = 'translateX(5px) rotate(5deg)';
            setTimeout(() => {
                enemy.element.style.transform = '';
            }, 200);
        }
        
        function checkPlayerHit() {
            const playerRect = playerShip.getBoundingClientRect();
            const containerRect = gameContainer.getBoundingClientRect();
            
            for (let i = gameState.projectiles.length - 1; i >= 0; i--) {
                const projectile = gameState.projectiles[i];
                
                if (projectile.side === 'enemy') {
                    const projectileLeft = projectile.x;
                    const projectileTop = projectile.y;
                    
                    if (
                        projectileLeft > playerRect.left - containerRect.left &&
                        projectileLeft < playerRect.right - containerRect.left &&
                        projectileTop > playerRect.top - containerRect.top &&
                        projectileTop < playerRect.bottom - containerRect.top
                    ) {
                        // Hit player
                        const damage = 5 + Math.floor(Math.random() * 10);
                        takeDamage(damage);
                        
                        // Create explosion
                        createExplosion(projectile.x, projectile.y);
                        
                        // Show damage text
                        createDamageText(projectile.x, projectile.y, damage);
                        
                        // Remove projectile
                        projectile.element.remove();
                        gameState.projectiles.splice(i, 1);
                        
                        showMessage(`Hit! -${damage} HP`, "red");
                    }
                }
            }
        }
        
        function takeDamage(amount) {
            gameState.playerHealth -= amount;
            
            // Crew also takes damage but less
            gameState.playerCrew -= amount * 0.7;
            
            // Clamp values
            gameState.playerHealth = Math.max(0, gameState.playerHealth);
            gameState.playerCrew = Math.max(0, gameState.playerCrew);
            
            updateStats();
            
            // Shake effect
            playerShip.style.animation = 'none';
            void playerShip.offsetWidth; // Trigger reflow
            playerShip.style.animation = 'shipRock 0.1s 3';
            
            // Check if game over
            if (gameState.playerHealth <= 0 || gameState.playerCrew <= 0) {
                gameOver();
            }
        }
        
        function createExplosion(x, y) {
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            explosion.style.left = `${x}px`;
            explosion.style.top = `${y}px`;
            
            effectsContainer.appendChild(explosion);
            
            setTimeout(() => {
                explosion.remove();
            }, 500);
        }
        
        function createSplash(x, y) {
            const splash = document.createElement('div');
            splash.className = 'splash';
            splash.style.left = `${x}px`;
            splash.style.top = `${y}px`;
            
            effectsContainer.appendChild(splash);
        }
        
        function createDamageText(x, y, amount) {
            const damageText = document.createElement('div');
            damageText.className = 'damage-text';
            damageText.textContent = `-${amount}`;
            damageText.style.left = `${x}px`;
            damageText.style.top = `${y}px`;
            
            effectsContainer.appendChild(damageText);
            
            setTimeout(() => {
                damageText.remove();
            }, 1000);
        }
        
        function createSinkingEffect(enemy) {
            const sinkingEffect = document.createElement('div');
            sinkingEffect.className = 'absolute overflow-hidden';
            sinkingEffect.style.left = `${enemy.x}px`;
            sinkingEffect.style.bottom = `${gameHeight - enemy.y}px`;
            sinkingEffect.style.width = `${enemy.element.offsetWidth}px`;
            sinkingEffect.style.height = `${enemy.element.offsetHeight}px`;
            
            // Clone the enemy ship for the effect
            const shipClone = enemy.element.cloneNode(true);
            shipClone.style.position = 'relative';
            shipClone.style.animation = 'sink 3s forwards';
            
            // Add bubbles
            for (let i = 0; i < 20; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'absolute bg-white rounded-full opacity-70';
                bubble.style.width = `${Math.random() * 10 + 5}px`;
                bubble.style.height = bubble.style.width;
                bubble.style.left = `${Math.random() * 100}%`;
                bubble.style.bottom = '0';
                bubble.style.animation = `floatUp ${Math.random() * 2 + 1}s forwards`;
                
                shipClone.appendChild(bubble);
            }
            
            sinkingEffect.appendChild(shipClone);
            effectsContainer.appendChild(sinkingEffect);
            
            setTimeout(() => {
                sinkingEffect.remove();
            }, 3000);
        }
        
        function updateWeather(timestamp, deltaTime) {
            gameState.weatherTimer += deltaTime;
            
            // Change weather every 15-30 seconds
            if (gameState.weatherTimer > 15000 + Math.random() * 15000) {
                gameState.weatherTimer = 0;
                
                const weatherTypes = ['clear', 'rain', 'storm', 'fog'];
                const newWeather = weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
                
                if (newWeather !== gameState.weather) {
                    gameState.weather = newWeather;
                    applyWeatherEffects();
                    
                    let weatherMessage = "";
                    switch(newWeather) {
                        case 'rain':
                            weatherMessage = "Rain is falling! Visibility reduced.";
                            break;
                        case 'storm':
                            weatherMessage = "Storm approaching! Rough seas ahead!";
                            break;
                        case 'fog':
                            weatherMessage = "Fog rolling in! Enemies harder to spot.";
                            break;
                        default:
                            weatherMessage = "Weather cleared! Smooth sailing.";
                    }
                    
                    showMessage(weatherMessage, "lightblue");
                }
            }
        }
        
        function applyWeatherEffects() {
            // Clear all weather effects
            weatherEffectsContainer.innerHTML = '';
            
            switch(gameState.weather) {
                case 'rain':
                    const rain = document.createElement('div');
                    rain.className = 'rain-effect';
                    rain.style.opacity = '0.5';
                    weatherEffectsContainer.appendChild(rain);
                    break;
                    
                case 'storm':
                    const heavyRain = document.createElement('div');
                    heavyRain.className = 'rain-effect';
                    heavyRain.style.opacity = '0.8';
                    weatherEffectsContainer.appendChild(heavyRain);
                    
                    // Add lightning flashes
                    setInterval(() => {
                        if (!gameState.isPaused && !gameState.isGameOver) {
                            weatherEffectsContainer.style.backgroundColor = 'white';
                            weatherEffectsContainer.style.opacity = '0.7';
                            setTimeout(() => {
                                weatherEffectsContainer.style.backgroundColor = '';
                                weatherEffectsContainer.style.opacity = '';
                            }, 100);
                        }
                    }, 3000 + Math.random() * 3000);
                    break;
                    
                case 'fog':
                    const fog = document.createElement('div');
                    fog.className = 'fog-effect';
                    weatherEffectsContainer.appendChild(fog);
                    break;
            }
        }
        
        function updateStats() {
            goldElement.textContent = gameState.gold;
            killsElement.textContent = gameState.kills;
            
            playerHealthElement.style.width = `${gameState.playerHealth}%`;
            playerCrewElement.style.width = `${gameState.playerCrew}%`;
            
            // Change color based on health
            if (gameState.playerHealth < 30) {
                playerHealthElement.classList.remove('bg-green-500', 'bg-yellow-500');
                playerHealthElement.classList.add('bg-red-500');
            } else if (gameState.playerHealth < 60) {
                playerHealthElement.classList.remove('bg-green-500', 'bg-red-500');
                playerHealthElement.classList.add('bg-yellow-500');
            } else {
                playerHealthElement.classList.remove('bg-yellow-500', 'bg-red-500');
                playerHealthElement.classList.add('bg-green-500');
            }
            
            // Change color based on crew
            if (gameState.playerCrew < 30) {
                playerCrewElement.classList.remove('bg-blue-400', 'bg-blue-300');
                playerCrewElement.classList.add('bg-blue-200');
            } else if (gameState.playerCrew < 60) {
                playerCrewElement.classList.remove('bg-blue-400', 'bg-blue-200');
                playerCrewElement.classList.add('bg-blue-300');
            } else {
                playerCrewElement.classList.remove('bg-blue-300', 'bg-blue-200');
                playerCrewElement.classList.add('bg-blue-400');
            }
        }
        
        function showMessage(text, color) {
            gameMessage.textContent = text;
            gameMessage.style.color = color;
            gameMessage.style.opacity = '1';
            
            setTimeout(() => {
                gameMessage.style.opacity = '0';
            }, 2000);
        }
        
        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            
            if (gameState.isPaused) {
                pauseMenu.classList.remove('hidden');
                
                // Update pause menu stats
                document.getElementById('pause-gold').textContent = gameState.gold;
                document.getElementById('pause-kills').textContent = gameState.kills;
                document.getElementById('pause-health').textContent = `${gameState.playerHealth}%`;
                document.getElementById('pause-crew').textContent = `${gameState.playerCrew}%`;
            } else {
                pauseMenu.classList.add('hidden');
                gameState.lastTime = performance.now(); // Reset timer to avoid large delta
            }
        }
        
        function gameOver() {
            gameState.isGameOver = true;
            gameOverScreen.classList.remove('hidden');
            
            // Update final stats
            document.getElementById('final-gold').textContent = gameState.gold;
            document.getElementById('final-kills').textContent = gameState.kills;
            document.getElementById('final-health').textContent = `${gameState.playerHealth}%`;
            document.getElementById('final-crew').textContent = `${gameState.playerCrew}%`;
            
            // Show sinking animation
            playerShip.style.animation = 'none';
            playerShip.style.transform = 'rotate(90deg)';
            playerShip.style.transition = 'transform 3s ease-in-out';
            
            // Add bubbles
            for (let i = 0; i < 30; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'absolute bg-white rounded-full opacity-70';
                bubble.style.width = `${Math.random() * 15 + 5}px`;
                bubble.style.height = bubble.style.width;
                bubble.style.left = `${Math.random() * 100}%`;
                bubble.style.bottom = '0';
                bubble.style.animation = `floatUp ${Math.random() * 3 + 1}s forwards`;
                
                playerShip.appendChild(bubble);
            }
        }
        
        function restartGame() {
            // Clear all game elements
            enemyShipsContainer.innerHTML = '';
            projectilesContainer.innerHTML = '';
            effectsContainer.innerHTML = '';
            weatherEffectsContainer.innerHTML = '';
            
            // Reset game state
            gameState.gold = 100;
            gameState.kills = 0;
            gameState.playerHealth = 100;
            gameState.playerCrew = 100;
            gameState.isPaused = false;
            gameState.isGameOver = false;
            gameState.weather = 'clear';
            gameState.weatherTimer = 0;
            gameState.enemySpawnTimer = 0;
            gameState.playerPosition = 25;
            gameState.playerSpeed = 0;
            gameState.leftCannonCooldown = 0;
            gameState.rightCannonCooldown = 0;
            gameState.enemies = [];
            gameState.projectiles = [];
            gameState.effects = [];
            
            // Reset player ship
            playerShip.style.transform = '';
            playerShip.style.animation = 'shipRock 4s infinite ease-in-out';
            playerShip.style.transition = '';
            
            // Update UI
            updateStats();
            pauseMenu.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            
            // Start game loop
            gameState.lastTime = performance.now();
            requestAnimationFrame(gameLoop);
        }
        
        function quitGame() {
            // In a real game, this would navigate away or show a menu
            alert('Thanks for playing Pirate Ship Battle!');
        }
        
        // Game Loop
        function gameLoop(timestamp) {
            if (gameState.isPaused || gameState.isGameOver) {
                gameState.lastTime = timestamp;
                requestAnimationFrame(gameLoop);
                return;
            }
            
            // Calculate delta time for smooth animation
            const deltaTime = timestamp - gameState.lastTime;
            gameState.lastTime = timestamp;
            
            // Update game elements
            updatePlayerPosition();
            updateProjectiles(timestamp, deltaTime);
            updateEnemies(timestamp, deltaTime);
            checkPlayerHit();
            updateWeather(timestamp, deltaTime);
            
            // Spawn enemies
            gameState.enemySpawnTimer += deltaTime;
            if (gameState.enemySpawnTimer > gameState.enemySpawnInterval) {
                gameState.enemySpawnTimer = 0;
                createEnemy();
                
                // Gradually increase difficulty
                gameState.enemySpawnInterval = Math.max(1000, gameState.enemySpawnInterval - 50);
            }
            
            // Random gold rewards
            if (Math.random() < 0.001) {
                const bonus = 5 + Math.floor(Math.random() * 15);
                gameState.gold += bonus;
                updateStats();
                showMessage(`Found floating treasure! +${bonus}g`, "gold");
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // Start the game
        restartGame();
    </script>
</body>
</html>