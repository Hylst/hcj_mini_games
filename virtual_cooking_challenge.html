<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Cooking Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes chop {
            0% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(5px) rotate(5deg); }
            100% { transform: translateY(0) rotate(0); }
        }
        
        @keyframes sizzle {
            0% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.8; transform: scale(1); }
        }
        
        @keyframes flip {
            0% { transform: rotateY(0); }
            50% { transform: rotateY(180deg); }
            100% { transform: rotateY(0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .chopping {
            animation: chop 0.3s infinite;
        }
        
        .sizzling {
            animation: sizzle 1s infinite;
        }
        
        .flipping {
            animation: flip 0.5s;
        }
        
        .pulsing {
            animation: pulse 1s infinite;
        }
        
        .progress-bar {
            transition: width 0.3s ease;
        }
        
        .ingredient-drag {
            cursor: grab;
            transition: transform 0.2s;
        }
        
        .ingredient-drag:active {
            cursor: grabbing;
            transform: scale(1.1);
        }
        
        .station-highlight {
            box-shadow: 0 0 15px 5px rgba(255, 215, 0, 0.7);
            transition: box-shadow 0.3s;
        }
        
        .dish-complete {
            transform: scale(1);
            transition: transform 0.5s, opacity 0.5s;
        }
        
        .dish-complete:hover {
            transform: scale(1.05);
        }
        
        .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .has-tooltip:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
        }
    </style>
</head>
<body class="bg-amber-50 font-sans">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-amber-800 mb-2">Virtual Cooking Challenge</h1>
            <p class="text-lg text-amber-700">Test your culinary skills against the clock!</p>
            
            <div class="flex justify-between items-center mt-6 bg-amber-100 rounded-lg p-4 shadow-md">
                <div class="text-left">
                    <h3 class="font-semibold text-amber-800">Time: <span id="timer" class="font-mono">03:00</span></h3>
                    <div class="w-full bg-gray-200 rounded-full h-4 mt-1">
                        <div id="time-bar" class="bg-amber-600 h-4 rounded-full progress-bar" style="width: 100%"></div>
                    </div>
                </div>
                
                <div class="text-center">
                    <h3 class="font-semibold text-amber-800">Score: <span id="score">0</span></h3>
                    <div class="flex justify-center mt-1">
                        <i class="fas fa-star text-amber-400"></i>
                        <i class="fas fa-star text-gray-300 ml-1"></i>
                        <i class="fas fa-star text-gray-300 ml-1"></i>
                    </div>
                </div>
                
                <div class="text-right">
                    <h3 class="font-semibold text-amber-800">Orders: <span id="orders-completed">0</span>/5</h3>
                    <div class="w-full bg-gray-200 rounded-full h-4 mt-1">
                        <div id="orders-bar" class="bg-green-600 h-4 rounded-full progress-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Game Area -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Ingredients Panel -->
            <div class="bg-white p-4 rounded-lg shadow-md">
                <h2 class="text-xl font-bold text-amber-800 mb-4 border-b pb-2">Ingredients</h2>
                <div class="grid grid-cols-3 gap-3">
                    <div class="ingredient-drag bg-amber-100 p-2 rounded-lg text-center cursor-pointer" draggable="true" data-ingredient="tomato">
                        <i class="fas fa-apple-alt text-red-500 text-3xl"></i>
                        <p class="text-sm mt-1">Tomato</p>
                    </div>
                    <div class="ingredient-drag bg-amber-100 p-2 rounded-lg text-center cursor-pointer" draggable="true" data-ingredient="onion">
                        <i class="fas fa-ring text-purple-500 text-3xl"></i>
                        <p class="text-sm mt-1">Onion</p>
                    </div>
                    <div class="ingredient-drag bg-amber-100 p-2 rounded-lg text-center cursor-pointer" draggable="true" data-ingredient="meat">
                        <i class="fas fa-drumstick-bite text-amber-700 text-3xl"></i>
                        <p class="text-sm mt-1">Meat</p>
                    </div>
                    <div class="ingredient-drag bg-amber-100 p-2 rounded-lg text-center cursor-pointer" draggable="true" data-ingredient="cheese">
                        <i class="fas fa-cheese text-yellow-400 text-3xl"></i>
                        <p class="text-sm mt-1">Cheese</p>
                    </div>
                    <div class="ingredient-drag bg-amber-100 p-2 rounded-lg text-center cursor-pointer" draggable="true" data-ingredient="lettuce">
                        <i class="fas fa-leaf text-green-500 text-3xl"></i>
                        <p class="text-sm mt-1">Lettuce</p>
                    </div>
                    <div class="ingredient-drag bg-amber-100 p-2 rounded-lg text-center cursor-pointer" draggable="true" data-ingredient="bread">
                        <i class="fas fa-bread-slice text-amber-600 text-3xl"></i>
                        <p class="text-sm mt-1">Bread</p>
                    </div>
                </div>
            </div>
            
            <!-- Cooking Stations -->
            <div class="space-y-4">
                <!-- Chopping Station -->
                <div id="chopping-station" class="bg-white p-4 rounded-lg shadow-md station" data-station="chopping">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-xl font-bold text-amber-800">Chopping Station</h2>
                        <span class="bg-amber-200 text-amber-800 px-2 py-1 rounded-full text-xs">Chop Ingredients</span>
                    </div>
                    <div class="bg-amber-50 rounded-lg p-4 h-32 flex items-center justify-center">
                        <div id="chopping-board" class="relative w-full h-full flex items-center justify-center">
                            <img src="https://cdn-icons-png.flaticon.com/512/3144/3144466.png" class="w-16 absolute opacity-20" alt="chopping board">
                            <div id="chopping-content" class="z-10"></div>
                        </div>
                    </div>
                    <div id="chopping-progress" class="mt-3 hidden">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-amber-700">Chopping...</span>
                            <span class="text-sm font-medium text-amber-700"><span id="chop-count">0</span>/10</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div id="chop-bar" class="bg-amber-600 h-2.5 rounded-full progress-bar" style="width: 0%"></div>
                        </div>
                        <button id="chop-btn" class="mt-2 w-full bg-amber-600 hover:bg-amber-700 text-white py-2 px-4 rounded-lg">
                            <i class="fas fa-utensils mr-2"></i>Chop!
                        </button>
                    </div>
                </div>
                
                <!-- Cooking Station -->
                <div id="cooking-station" class="bg-white p-4 rounded-lg shadow-md station" data-station="cooking">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-xl font-bold text-amber-800">Cooking Station</h2>
                        <span class="bg-red-200 text-red-800 px-2 py-1 rounded-full text-xs">Cook Ingredients</span>
                    </div>
                    <div class="bg-amber-50 rounded-lg p-4 h-32 flex items-center justify-center">
                        <div id="cooking-pan" class="relative w-full h-full flex items-center justify-center">
                            <img src="https://cdn-icons-png.flaticon.com/512/3144/3144487.png" class="w-20 absolute opacity-20" alt="frying pan">
                            <div id="cooking-content" class="z-10"></div>
                        </div>
                    </div>
                    <div id="cooking-controls" class="mt-3 hidden">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-red-700">Cooking...</span>
                            <span class="text-sm font-medium text-red-700">Heat: <span id="heat-level">Medium</span></span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div id="cook-bar" class="bg-red-600 h-2.5 rounded-full progress-bar" style="width: 0%"></div>
                        </div>
                        <div class="flex space-x-2 mt-2">
                            <button id="heat-down" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 px-4 rounded-lg">
                                <i class="fas fa-temperature-low mr-2"></i>Lower
                            </button>
                            <button id="flip-btn" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg">
                                <i class="fas fa-sync-alt mr-2"></i>Flip
                            </button>
                            <button id="heat-up" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 px-4 rounded-lg">
                                <i class="fas fa-temperature-high mr-2"></i>Higher
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Order & Assembly -->
            <div class="space-y-4">
                <!-- Current Order -->
                <div class="bg-white p-4 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-xl font-bold text-amber-800">Current Order</h2>
                        <span class="bg-green-200 text-green-800 px-2 py-1 rounded-full text-xs">Time Bonus: +<span id="time-bonus">50</span></span>
                    </div>
                    <div id="current-order" class="bg-green-50 rounded-lg p-4 min-h-32">
                        <div id="order-description" class="text-center text-gray-500 italic py-8">
                            Drag ingredients to stations to start cooking!
                        </div>
                        <div id="order-items" class="grid grid-cols-3 gap-2 hidden">
                            <!-- Order items will be inserted here -->
                        </div>
                    </div>
                    <button id="submit-order" class="mt-3 w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg hidden">
                        <i class="fas fa-paper-plane mr-2"></i>Submit Order
                    </button>
                </div>
                
                <!-- Assembly Station -->
                <div id="assembly-station" class="bg-white p-4 rounded-lg shadow-md station" data-station="assembly">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-xl font-bold text-amber-800">Assembly Station</h2>
                        <span class="bg-blue-200 text-blue-800 px-2 py-1 rounded-full text-xs">Build Dish</span>
                    </div>
                    <div class="bg-amber-50 rounded-lg p-4 h-48 flex items-center justify-center">
                        <div id="assembly-plate" class="relative w-full h-full flex items-center justify-center">
                            <img src="https://cdn-icons-png.flaticon.com/512/3144/3144476.png" class="w-24 absolute opacity-20" alt="plate">
                            <div id="assembly-content" class="z-10 grid grid-cols-2 gap-1 w-full h-full p-4"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Recipe Book (Hidden by default) -->
        <div id="recipe-book" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                <div class="sticky top-0 bg-amber-600 text-white p-4 flex justify-between items-center">
                    <h2 class="text-xl font-bold">Recipe Book</h2>
                    <button id="close-recipe-book" class="text-white hover:text-amber-200">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-amber-800 mb-2">How to Play</h3>
                        <ol class="list-decimal pl-5 space-y-2 text-gray-700">
                            <li>Drag ingredients to the appropriate stations</li>
                            <li>Complete the mini-games at each station</li>
                            <li>Assemble the dish according to the order</li>
                            <li>Submit before time runs out for bonus points!</li>
                        </ol>
                    </div>
                    
                    <h3 class="text-lg font-semibold text-amber-800 mb-4">Sample Recipes</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="border border-amber-200 rounded-lg p-4">
                            <div class="flex items-center mb-3">
                                <div class="bg-amber-100 p-2 rounded-full mr-3">
                                    <i class="fas fa-hamburger text-amber-600 text-xl"></i>
                                </div>
                                <h4 class="font-bold text-amber-800">Classic Burger</h4>
                            </div>
                            <ul class="space-y-1 text-sm text-gray-700">
                                <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-2"></i> Chop: Tomato, Onion, Lettuce</li>
                                <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-2"></i> Cook: Meat patty</li>
                                <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-2"></i> Assemble: Bread + Cheese + Patty + Veggies</li>
                            </ul>
                        </div>
                        
                        <div class="border border-amber-200 rounded-lg p-4">
                            <div class="flex items-center mb-3">
                                <div class="bg-amber-100 p-2 rounded-full mr-3">
                                    <i class="fas fa-pizza-slice text-red-500 text-xl"></i>
                                </div>
                                <h4 class="font-bold text-amber-800">Veggie Pizza</h4>
                            </div>
                            <ul class="space-y-1 text-sm text-gray-700">
                                <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-2"></i> Chop: Tomato, Onion, Bell Pepper</li>
                                <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-2"></i> Cook: (None, just assemble)</li>
                                <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-2"></i> Assemble: Bread + Cheese + Chopped Veggies</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Game Over Modal (Hidden by default) -->
        <div id="game-over-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 text-center">
                <h2 class="text-3xl font-bold text-amber-800 mb-4">Game Over!</h2>
                <div class="text-xl mb-6">
                    <p>You completed <span id="final-orders" class="font-bold">0</span> orders</p>
                    <p>with a score of <span id="final-score" class="font-bold">0</span> points!</p>
                </div>
                <div class="flex justify-center mb-6">
                    <div id="final-stars" class="flex">
                        <i class="fas fa-star text-gray-300 text-3xl mx-1"></i>
                        <i class="fas fa-star text-gray-300 text-3xl mx-1"></i>
                        <i class="fas fa-star text-gray-300 text-3xl mx-1"></i>
                    </div>
                </div>
                <button id="play-again-btn" class="bg-amber-600 hover:bg-amber-700 text-white py-3 px-6 rounded-lg text-lg font-semibold">
                    <i class="fas fa-redo mr-2"></i>Play Again
                </button>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="text-center mt-8 text-gray-600">
            <button id="help-btn" class="bg-amber-100 hover:bg-amber-200 text-amber-800 py-2 px-4 rounded-lg">
                <i class="fas fa-question-circle mr-2"></i>Help & Recipes
            </button>
            <p class="mt-4">Virtual Cooking Challenge - Test your culinary time management skills!</p>
        </footer>
    </div>

    <script>
        // Game State
        const gameState = {
            timeLeft: 180, // 3 minutes in seconds
            score: 0,
            ordersCompleted: 0,
            currentOrder: null,
            activeStation: null,
            choppedIngredients: [],
            cookedIngredients: [],
            assembledIngredients: [],
            isChopping: false,
            isCooking: false,
            chopProgress: 0,
            cookProgress: 0,
            cookHeat: 1, // 0: low, 1: medium, 2: high
            cookFlipCount: 0,
            timerInterval: null,
            gameActive: false
        };

        // Sample Orders
        const orders = [
            {
                name: "Classic Burger",
                description: "A juicy burger with fresh veggies",
                ingredients: [
                    { name: "bread", type: "assembly", processed: false },
                    { name: "cheese", type: "assembly", processed: false },
                    { name: "meat", type: "cooking", processed: false, cookTime: 10, flipNeeded: 2 },
                    { name: "tomato", type: "chopping", processed: false, chopsNeeded: 8 },
                    { name: "onion", type: "chopping", processed: false, chopsNeeded: 10 },
                    { name: "lettuce", type: "chopping", processed: false, chopsNeeded: 5 }
                ],
                timeBonus: 50,
                basePoints: 100
            },
            {
                name: "Cheese Sandwich",
                description: "Simple grilled cheese sandwich",
                ingredients: [
                    { name: "bread", type: "assembly", processed: false },
                    { name: "cheese", type: "assembly", processed: false },
                    { name: "bread", type: "assembly", processed: false }
                ],
                timeBonus: 30,
                basePoints: 60
            },
            {
                name: "Salad Bowl",
                description: "Fresh vegetable salad",
                ingredients: [
                    { name: "lettuce", type: "chopping", processed: false, chopsNeeded: 8 },
                    { name: "tomato", type: "chopping", processed: false, chopsNeeded: 8 },
                    { name: "onion", type: "chopping", processed: false, chopsNeeded: 5 },
                    { name: "cheese", type: "chopping", processed: false, chopsNeeded: 5 }
                ],
                timeBonus: 40,
                basePoints: 80
            }
        ];

        // DOM Elements
        const elements = {
            timer: document.getElementById('timer'),
            timeBar: document.getElementById('time-bar'),
            score: document.getElementById('score'),
            ordersCompleted: document.getElementById('orders-completed'),
            ordersBar: document.getElementById('orders-bar'),
            timeBonus: document.getElementById('time-bonus'),
            
            // Stations
            choppingStation: document.getElementById('chopping-station'),
            choppingContent: document.getElementById('chopping-content'),
            choppingProgress: document.getElementById('chopping-progress'),
            chopCount: document.getElementById('chop-count'),
            chopBar: document.getElementById('chop-bar'),
            chopBtn: document.getElementById('chop-btn'),
            
            cookingStation: document.getElementById('cooking-station'),
            cookingContent: document.getElementById('cooking-content'),
            cookingControls: document.getElementById('cooking-controls'),
            heatLevel: document.getElementById('heat-level'),
            cookBar: document.getElementById('cook-bar'),
            heatUp: document.getElementById('heat-up'),
            heatDown: document.getElementById('heat-down'),
            flipBtn: document.getElementById('flip-btn'),
            
            assemblyStation: document.getElementById('assembly-station'),
            assemblyContent: document.getElementById('assembly-content'),
            
            // Order
            currentOrder: document.getElementById('current-order'),
            orderDescription: document.getElementById('order-description'),
            orderItems: document.getElementById('order-items'),
            submitOrder: document.getElementById('submit-order'),
            
            // Modals
            recipeBook: document.getElementById('recipe-book'),
            closeRecipeBook: document.getElementById('close-recipe-book'),
            helpBtn: document.getElementById('help-btn'),
            
            gameOverModal: document.getElementById('game-over-modal'),
            finalOrders: document.getElementById('final-orders'),
            finalScore: document.getElementById('final-score'),
            finalStars: document.getElementById('final-stars'),
            playAgainBtn: document.getElementById('play-again-btn')
        };

        // Initialize game
        function initGame() {
            // Reset game state
            gameState.timeLeft = 180;
            gameState.score = 0;
            gameState.ordersCompleted = 0;
            gameState.currentOrder = null;
            gameState.activeStation = null;
            gameState.choppedIngredients = [];
            gameState.cookedIngredients = [];
            gameState.assembledIngredients = [];
            gameState.isChopping = false;
            gameState.isCooking = false;
            gameState.chopProgress = 0;
            gameState.cookProgress = 0;
            gameState.cookHeat = 1;
            gameState.cookFlipCount = 0;
            gameState.gameActive = true;
            
            // Update UI
            updateTimer();
            updateScore();
            updateOrdersCompleted();
            elements.orderDescription.classList.remove('hidden');
            elements.orderItems.classList.add('hidden');
            elements.submitOrder.classList.add('hidden');
            elements.choppingProgress.classList.add('hidden');
            elements.cookingControls.classList.add('hidden');
            elements.choppingContent.innerHTML = '';
            elements.cookingContent.innerHTML = '';
            elements.assemblyContent.innerHTML = '';
            
            // Start timer
            if (gameState.timerInterval) clearInterval(gameState.timerInterval);
            gameState.timerInterval = setInterval(updateGameTimer, 1000);
            
            // Generate first order
            generateNewOrder();
            
            // Setup drag and drop
            setupDragAndDrop();
            
            // Hide modals
            elements.recipeBook.classList.add('hidden');
            elements.gameOverModal.classList.add('hidden');
        }

        // Update game timer
        function updateGameTimer() {
            gameState.timeLeft--;
            updateTimer();
            
            if (gameState.timeLeft <= 0) {
                endGame();
            }
        }

        // Update timer display
        function updateTimer() {
            const minutes = Math.floor(gameState.timeLeft / 60);
            const seconds = gameState.timeLeft % 60;
            elements.timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Update progress bar
            const percent = (gameState.timeLeft / 180) * 100;
            elements.timeBar.style.width = `${percent}%`;
            
            // Change color when time is running low
            if (gameState.timeLeft <= 30) {
                elements.timeBar.classList.remove('bg-amber-600');
                elements.timeBar.classList.add('bg-red-600');
                elements.timer.classList.add('text-red-600');
                elements.timer.classList.remove('text-amber-800');
                
                // Pulse animation when time is very low
                if (gameState.timeLeft <= 10) {
                    elements.timer.classList.add('pulsing');
                }
            } else {
                elements.timeBar.classList.remove('bg-red-600');
                elements.timeBar.classList.add('bg-amber-600');
                elements.timer.classList.remove('text-red-600');
                elements.timer.classList.add('text-amber-800');
                elements.timer.classList.remove('pulsing');
            }
        }

        // Update score display
        function updateScore() {
            elements.score.textContent = gameState.score;
            
            // Update stars based on score
            const stars = document.querySelectorAll('#score-display i');
            stars.forEach((star, index) => {
                if (gameState.score >= (index + 1) * 100) {
                    star.classList.remove('text-gray-300');
                    star.classList.add('text-amber-400');
                } else {
                    star.classList.remove('text-amber-400');
                    star.classList.add('text-gray-300');
                }
            });
        }

        // Update orders completed display
        function updateOrdersCompleted() {
            elements.ordersCompleted.textContent = gameState.ordersCompleted;
            
            // Update progress bar
            const percent = (gameState.ordersCompleted / 5) * 100;
            elements.ordersBar.style.width = `${percent}%`;
        }

        // Generate a new random order
        function generateNewOrder() {
            if (gameState.ordersCompleted >= 5) {
                endGame();
                return;
            }
            
            const randomOrder = orders[Math.floor(Math.random() * orders.length)];
            gameState.currentOrder = JSON.parse(JSON.stringify(randomOrder)); // Deep copy
            
            // Update UI
            elements.orderDescription.classList.add('hidden');
            elements.orderItems.classList.remove('hidden');
            elements.orderItems.innerHTML = '';
            elements.timeBonus.textContent = gameState.currentOrder.timeBonus;
            
            // Create order items
            gameState.currentOrder.ingredients.forEach(ingredient => {
                const item = document.createElement('div');
                item.className = 'bg-amber-100 rounded p-1 text-center';
                item.innerHTML = `
                    <i class="fas fa-${getIngredientIcon(ingredient.name)} text-${getIngredientColor(ingredient.name)} text-xl"></i>
                    <p class="text-xs mt-1">${ingredient.name}</p>
                    ${ingredient.type === 'chopping' ? '<span class="text-xs block">(Chop)</span>' : ''}
                    ${ingredient.type === 'cooking' ? '<span class="text-xs block">(Cook)</span>' : ''}
                `;
                item.dataset.ingredient = ingredient.name;
                item.dataset.type = ingredient.type;
                elements.orderItems.appendChild(item);
            });
            
            // Show submit button when order is ready
            elements.submitOrder.classList.add('hidden');
        }

        // Get icon for ingredient
        function getIngredientIcon(ingredient) {
            const icons = {
                tomato: 'apple-alt',
                onion: 'ring',
                meat: 'drumstick-bite',
                cheese: 'cheese',
                lettuce: 'leaf',
                bread: 'bread-slice'
            };
            return icons[ingredient] || 'question';
        }

        // Get color for ingredient
        function getIngredientColor(ingredient) {
            const colors = {
                tomato: 'red-500',
                onion: 'purple-500',
                meat: 'amber-700',
                cheese: 'yellow-400',
                lettuce: 'green-500',
                bread: 'amber-600'
            };
            return colors[ingredient] || 'gray-500';
        }

        // Setup drag and drop functionality
        function setupDragAndDrop() {
            const ingredients = document.querySelectorAll('.ingredient-drag');
            const stations = document.querySelectorAll('.station');
            
            // Add drag start event to ingredients
            ingredients.forEach(ingredient => {
                ingredient.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', ingredient.dataset.ingredient);
                    setTimeout(() => {
                        ingredient.classList.add('opacity-50');
                    }, 0);
                });
                
                ingredient.addEventListener('dragend', () => {
                    ingredient.classList.remove('opacity-50');
                });
            });
            
            // Add drag over and drop events to stations
            stations.forEach(station => {
                station.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    station.classList.add('station-highlight');
                });
                
                station.addEventListener('dragleave', () => {
                    station.classList.remove('station-highlight');
                });
                
                station.addEventListener('drop', (e) => {
                    e.preventDefault();
                    station.classList.remove('station-highlight');
                    
                    const ingredient = e.dataTransfer.getData('text/plain');
                    const stationType = station.dataset.station;
                    
                    // Check if this ingredient is needed in the current order
                    const orderIngredient = gameState.currentOrder.ingredients.find(
                        item => item.name === ingredient && item.type === stationType
                    );
                    
                    if (!orderIngredient) {
                        showFeedback(station, 'Not needed!', 'red-500');
                        return;
                    }
                    
                    // Check if already processed
                    if (orderIngredient.processed) {
                        showFeedback(station, 'Already done!', 'amber-500');
                        return;
                    }
                    
                    // Process based on station type
                    if (stationType === 'chopping') {
                        startChopping(ingredient, orderIngredient);
                    } else if (stationType === 'cooking') {
                        startCooking(ingredient, orderIngredient);
                    } else if (stationType === 'assembly') {
                        addToAssembly(ingredient);
                    }
                });
            });
        }

        // Show feedback message
        function showFeedback(element, message, color) {
            const feedback = document.createElement('div');
            feedback.className = `absolute bg-${color} text-white px-3 py-1 rounded-full text-sm`;
            feedback.textContent = message;
            
            const rect = element.getBoundingClientRect();
            feedback.style.top = `${rect.top - 30}px`;
            feedback.style.left = `${rect.left + rect.width / 2 - 50}px`;
            
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                feedback.style.transition = 'all 0.3s';
                feedback.style.opacity = '0';
                feedback.style.transform = 'translateY(-10px)';
                
                setTimeout(() => {
                    document.body.removeChild(feedback);
                }, 300);
            }, 1000);
        }

        // Start chopping process
        function startChopping(ingredient, orderIngredient) {
            gameState.activeStation = 'chopping';
            gameState.currentChoppingIngredient = ingredient;
            gameState.currentChoppingOrderItem = orderIngredient;
            gameState.chopProgress = 0;
            
            // Update UI
            elements.choppingContent.innerHTML = `
                <i class="fas fa-${getIngredientIcon(ingredient)} text-${getIngredientColor(ingredient)} text-5xl"></i>
                <div class="absolute bottom-0 left-0 right-0 text-center text-xs">
                    ${ingredient}
                </div>
            `;
            
            elements.choppingProgress.classList.remove('hidden');
            elements.chopCount.textContent = `0/${orderIngredient.chopsNeeded}`;
            elements.chopBar.style.width = '0%';
            
            // Setup chop button
            elements.chopBtn.onclick = () => {
                if (gameState.isChopping) return;
                
                gameState.isChopping = true;
                elements.choppingContent.firstElementChild.classList.add('chopping');
                
                setTimeout(() => {
                    gameState.isChopping = false;
                    elements.choppingContent.firstElementChild.classList.remove('chopping');
                    
                    gameState.chopProgress++;
                    const percent = (gameState.chopProgress / orderIngredient.chopsNeeded) * 100;
                    elements.chopBar.style.width = `${percent}%`;
                    elements.chopCount.textContent = `${gameState.chopProgress}/${orderIngredient.chopsNeeded}`;
                    
                    if (gameState.chopProgress >= orderIngredient.chopsNeeded) {
                        finishChopping();
                    }
                }, 300);
            };
        }

        // Finish chopping process
        function finishChopping() {
            const ingredient = gameState.currentChoppingIngredient;
            gameState.currentChoppingOrderItem.processed = true;
            gameState.choppedIngredients.push(ingredient);
            gameState.activeStation = null;
            
            // Update UI
            elements.choppingProgress.classList.add('hidden');
            elements.choppingContent.innerHTML = `
                <i class="fas fa-${getIngredientIcon(ingredient)} text-${getIngredientColor(ingredient)} text-5xl"></i>
                <div class="absolute bottom-0 left-0 right-0 text-center text-xs">
                    Chopped ${ingredient}
                </div>
            `;
            
            // Mark as complete in order items
            const orderItem = document.querySelector(`#order-items [data-ingredient="${ingredient}"]`);
            if (orderItem) {
                orderItem.classList.remove('bg-amber-100');
                orderItem.classList.add('bg-green-100');
                orderItem.innerHTML += '<div class="text-green-500 text-xs"><i class="fas fa-check"></i></div>';
            }
            
            // Check if order can be submitted
            checkOrderCompletion();
        }

        // Start cooking process
        function startCooking(ingredient, orderIngredient) {
            gameState.activeStation = 'cooking';
            gameState.currentCookingIngredient = ingredient;
            gameState.currentCookingOrderItem = orderIngredient;
            gameState.cookProgress = 0;
            gameState.cookHeat = 1;
            gameState.cookFlipCount = 0;
            
            // Update UI
            elements.cookingContent.innerHTML = `
                <i class="fas fa-${getIngredientIcon(ingredient)} text-${getIngredientColor(ingredient)} text-5xl sizzling"></i>
                <div class="absolute bottom-0 left-0 right-0 text-center text-xs">
                    ${ingredient}
                </div>
            `;
            
            elements.cookingControls.classList.remove('hidden');
            elements.cookBar.style.width = '0%';
            updateHeatDisplay();
            
            // Start cooking interval
            if (gameState.cookingInterval) clearInterval(gameState.cookingInterval);
            gameState.cookingInterval = setInterval(() => {
                if (gameState.isCooking) return;
                
                gameState.isCooking = true;
                
                // Increase progress based on heat level
                let progressIncrease = 0;
                if (gameState.cookHeat === 0) progressIncrease = 1; // Low heat
                if (gameState.cookHeat === 1) progressIncrease = 2; // Medium heat
                if (gameState.cookHeat === 2) progressIncrease = 3; // High heat
                
                gameState.cookProgress += progressIncrease;
                const percent = (gameState.cookProgress / orderIngredient.cookTime) * 100;
                elements.cookBar.style.width = `${percent}%`;
                
                // Change color based on progress
                if (percent > 80) {
                    elements.cookBar.classList.remove('bg-red-600');
                    elements.cookBar.classList.add('bg-red-800');
                } else {
                    elements.cookBar.classList.remove('bg-red-800');
                    elements.cookBar.classList.add('bg-red-600');
                }
                
                // Check if cooking is done
                if (gameState.cookProgress >= orderIngredient.cookTime) {
                    clearInterval(gameState.cookingInterval);
                    
                    // Check if enough flips were done
                    if (gameState.cookFlipCount >= orderIngredient.flipNeeded) {
                        finishCooking(true);
                    } else {
                        finishCooking(false);
                    }
                }
                
                gameState.isCooking = false;
            }, 1000);
            
            // Setup heat controls
            elements.heatUp.onclick = () => {
                if (gameState.cookHeat < 2) {
                    gameState.cookHeat++;
                    updateHeatDisplay();
                }
            };
            
            elements.heatDown.onclick = () => {
                if (gameState.cookHeat > 0) {
                    gameState.cookHeat--;
                    updateHeatDisplay();
                }
            };
            
            // Setup flip button
            elements.flipBtn.onclick = () => {
                elements.cookingContent.firstElementChild.classList.add('flipping');
                gameState.cookFlipCount++;
                
                setTimeout(() => {
                    elements.cookingContent.firstElementChild.classList.remove('flipping');
                }, 500);
            };
        }

        // Update heat level display
        function updateHeatDisplay() {
            const heatLevels = ['Low', 'Medium', 'High'];
            elements.heatLevel.textContent = heatLevels[gameState.cookHeat];
            
            // Update button states
            if (gameState.cookHeat === 0) {
                elements.heatDown.disabled = true;
                elements.heatDown.classList.add('opacity-50');
            } else {
                elements.heatDown.disabled = false;
                elements.heatDown.classList.remove('opacity-50');
            }
            
            if (gameState.cookHeat === 2) {
                elements.heatUp.disabled = true;
                elements.heatUp.classList.add('opacity-50');
            } else {
                elements.heatUp.disabled = false;
                elements.heatUp.classList.remove('opacity-50');
            }
        }

        // Finish cooking process
        function finishCooking(success) {
            const ingredient = gameState.currentCookingIngredient;
            gameState.activeStation = null;
            
            clearInterval(gameState.cookingInterval);
            elements.cookingControls.classList.add('hidden');
            
            if (success) {
                gameState.currentCookingOrderItem.processed = true;
                gameState.cookedIngredients.push(ingredient);
                
                elements.cookingContent.innerHTML = `
                    <i class="fas fa-${getIngredientIcon(ingredient)} text-${getIngredientColor(ingredient)} text-5xl"></i>
                    <div class="absolute bottom-0 left-0 right-0 text-center text-xs">
                        Cooked ${ingredient}
                    </div>
                `;
                
                // Mark as complete in order items
                const orderItem = document.querySelector(`#order-items [data-ingredient="${ingredient}"]`);
                if (orderItem) {
                    orderItem.classList.remove('bg-amber-100');
                    orderItem.classList.add('bg-green-100');
                    orderItem.innerHTML += '<div class="text-green-500 text-xs"><i class="fas fa-check"></i></div>';
                }
                
                // Check if order can be submitted
                checkOrderCompletion();
            } else {
                // Cooking failed (not enough flips)
                elements.cookingContent.innerHTML = `
                    <i class="fas fa-${getIngredientIcon(ingredient)} text-gray-500 text-5xl"></i>
                    <div class="absolute bottom-0 left-0 right-0 text-center text-xs">
                        Burnt ${ingredient}
                    </div>
                `;
                
                showFeedback(elements.cookingStation, 'Not enough flips!', 'red-500');
                
                // Reset after delay
                setTimeout(() => {
                    elements.cookingContent.innerHTML = '';
                }, 2000);
            }
        }

        // Add ingredient to assembly station
        function addToAssembly(ingredient) {
            // Check if this ingredient is needed in the current order
            const orderIngredient = gameState.currentOrder.ingredients.find(
                item => item.name === ingredient && item.type === 'assembly'
            );
            
            if (!orderIngredient) {
                showFeedback(elements.assemblyStation, 'Not needed!', 'red-500');
                return;
            }
            
            // Check if already added
            if (orderIngredient.processed) {
                showFeedback(elements.assemblyStation, 'Already added!', 'amber-500');
                return;
            }
            
            // Add to assembly
            orderIngredient.processed = true;
            gameState.assembledIngredients.push(ingredient);
            
            // Add to assembly station
            const assemblyItem = document.createElement('div');
            assemblyItem.className = 'bg-white rounded-full p-2 flex items-center justify-center';
            assemblyItem.innerHTML = `
                <i class="fas fa-${getIngredientIcon(ingredient)} text-${getIngredientColor(ingredient)} text-2xl"></i>
            `;
            elements.assemblyContent.appendChild(assemblyItem);
            
            // Mark as complete in order items
            const orderItem = document.querySelector(`#order-items [data-ingredient="${ingredient}"]`);
            if (orderItem) {
                orderItem.classList.remove('bg-amber-100');
                orderItem.classList.add('bg-green-100');
                orderItem.innerHTML += '<div class="text-green-500 text-xs"><i class="fas fa-check"></i></div>';
            }
            
            // Check if order can be submitted
            checkOrderCompletion();
        }

        // Check if order is ready to submit
        function checkOrderCompletion() {
            const allProcessed = gameState.currentOrder.ingredients.every(ing => ing.processed);
            
            if (allProcessed) {
                elements.submitOrder.classList.remove('hidden');
                
                // Calculate time bonus (decreases over time)
                const timeElapsed = 180 - gameState.timeLeft;
                const bonusPercentage = Math.max(0, 100 - (timeElapsed / 180) * 100);
                gameState.currentOrder.timeBonus = Math.round(gameState.currentOrder.timeBonus * (bonusPercentage / 100));
                elements.timeBonus.textContent = gameState.currentOrder.timeBonus;
            }
        }

        // Submit completed order
        elements.submitOrder.onclick = () => {
            // Calculate score
            let orderScore = gameState.currentOrder.basePoints;
            orderScore += gameState.currentOrder.timeBonus;
            
            // Add to total score
            gameState.score += orderScore;
            gameState.ordersCompleted++;
            
            // Update UI
            updateScore();
            updateOrdersCompleted();
            
            // Show completion animation
            showOrderCompleteAnimation(orderScore);
            
            // Clear stations
            elements.choppingContent.innerHTML = '';
            elements.cookingContent.innerHTML = '';
            elements.assemblyContent.innerHTML = '';
            
            // Generate new order after delay
            setTimeout(() => {
                generateNewOrder();
            }, 2000);
        };

        // Show order complete animation
        function showOrderCompleteAnimation(score) {
            // Create dish complete element
            const dishComplete = document.createElement('div');
            dishComplete.className = 'dish-complete bg-white rounded-lg shadow-lg p-4 text-center absolute';
            dishComplete.style.top = '50%';
            dishComplete.style.left = '50%';
            dishComplete.style.transform = 'translate(-50%, -50%)';
            dishComplete.style.zIndex = '100';
            dishComplete.innerHTML = `
                <h3 class="text-xl font-bold text-green-600 mb-2">Order Complete!</h3>
                <p class="text-lg">+${score} points</p>
                <div class="mt-4 text-4xl">
                    ${gameState.currentOrder.name === 'Classic Burger' ? '<i class="fas fa-hamburger text-amber-600"></i>' : ''}
                    ${gameState.currentOrder.name === 'Cheese Sandwich' ? '<i class="fas fa-cheese text-yellow-400"></i>' : ''}
                    ${gameState.currentOrder.name === 'Salad Bowl' ? '<i class="fas fa-leaf text-green-500"></i>' : ''}
                </div>
            `;
            
            document.body.appendChild(dishComplete);
            
            // Create confetti
            createConfetti();
            
            // Remove after animation
            setTimeout(() => {
                dishComplete.style.opacity = '0';
                dishComplete.style.transform = 'translate(-50%, -50%) scale(0.5)';
                
                setTimeout(() => {
                    document.body.removeChild(dishComplete);
                }, 500);
            }, 1500);
        }

        // Create confetti effect
        function createConfetti() {
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.top = '-10px';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                document.body.appendChild(confetti);
                
                // Animate
                setTimeout(() => {
                    confetti.style.transition = 'all 1s';
                    confetti.style.opacity = '1';
                    confetti.style.top = `${Math.random() * 100 + 50}vh`;
                    confetti.style.left = `${parseFloat(confetti.style.left) + (Math.random() - 0.5) * 200}px`;
                    
                    setTimeout(() => {
                        confetti.style.opacity = '0';
                        
                        setTimeout(() => {
                            document.body.removeChild(confetti);
                        }, 1000);
                    }, 1000);
                }, i * 20);
            }
        }

        // End game
        function endGame() {
            clearInterval(gameState.timerInterval);
            if (gameState.cookingInterval) clearInterval(gameState.cookingInterval);
            gameState.gameActive = false;
            
            // Show game over modal
            elements.finalOrders.textContent = gameState.ordersCompleted;
            elements.finalScore.textContent = gameState.score;
            
            // Update stars
            elements.finalStars.innerHTML = '';
            const starCount = Math.min(3, Math.floor(gameState.score / 100));
            
            for (let i = 0; i < 3; i++) {
                const star = document.createElement('i');
                star.className = `fas fa-star text-3xl mx-1 ${i < starCount ? 'text-amber-400' : 'text-gray-300'}`;
                elements.finalStars.appendChild(star);
            }
            
            elements.gameOverModal.classList.remove('hidden');
        }

        // Event listeners
        elements.helpBtn.addEventListener('click', () => {
            elements.recipeBook.classList.remove('hidden');
        });
        
        elements.closeRecipeBook.addEventListener('click', () => {
            elements.recipeBook.classList.add('hidden');
        });
        
        elements.playAgainBtn.addEventListener('click', () => {
            elements.gameOverModal.classList.add('hidden');
            initGame();
        });
        
        // Start the game
        initGame();
    </script>
</body>
</html>