<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ninja Jump Adventure - Enhanced</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Animation Keyframes */
        @keyframes jump {
            0% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.1, 0.9); }
            100% { transform: translateY(0) scale(1); }
        }
        
        @keyframes land {
            0% { transform: scale(1.2, 0.8); }
            100% { transform: scale(1, 1); }
        }
        
        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0); }
        }
        
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        @keyframes enemy-walk {
            0% { transform: translateX(0); }
            100% { transform: translateX(100px); }
        }
        
        @keyframes cloud-move {
            0% { transform: translateX(0); }
            100% { transform: translateX(20px); }
        }
        
        @keyframes ninja-run {
            0% { background-position: 0 0; }
            100% { background-position: -384px 0; }
        }
        
        @keyframes ninja-idle {
            0% { background-position: 0 -64px; }
            100% { background-position: -256px -64px; }
        }
        
        @keyframes ninja-jump {
            0% { background-position: 0 -128px; }
            100% { background-position: -128px -128px; }
        }
        
        @keyframes coin-spin {
            0% { transform: rotateY(0); }
            100% { transform: rotateY(360deg); }
        }
        
        /* Animation Classes */
        .jump-animation {
            animation: jump 0.5s ease-out;
        }
        
        .land-animation {
            animation: land 0.2s ease-out;
        }
        
        .float-animation {
            animation: float 2s infinite ease-in-out;
        }
        
        .shake-animation {
            animation: shake 0.3s ease-in-out;
        }
        
        .pulse-animation {
            animation: pulse 1s infinite;
        }
        
        .enemy-walk {
            animation: enemy-walk 2s infinite alternate ease-in-out;
        }
        
        .cloud-move {
            animation: cloud-move 30s infinite alternate ease-in-out;
        }
        
        .coin-spin {
            animation: coin-spin 2s infinite linear;
        }
        
        /* Game Elements */
        .platform {
            transition: all 0.3s ease;
        }
        
        .bounce-platform:hover {
            transform: scale(1.05);
        }
        
        .hidden-area {
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .hidden-area.revealed {
            opacity: 1;
        }
        
        #game-container {
            background: linear-gradient(to bottom, #87CEEB, #1E90FF);
            position: relative;
            overflow: hidden;
        }
        
        .damage-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 0, 0, 0.3);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .damage-effect.active {
            opacity: 1;
        }
        
        .player-shadow {
            position: absolute;
            width: 40px;
            height: 12px;
            background: rgba(0,0,0,0.3);
            border-radius: 50%;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%) scale(0.8);
            transition: all 0.3s ease;
            filter: blur(3px);
        }
        
        /* Game UI */
        .pause-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }
        
        .double-jump-indicator {
            position: absolute;
            width: 100%;
            text-align: center;
            top: 20px;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px black;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 5;
        }
        
        .double-jump-indicator.active {
            opacity: 1;
        }
        
        .combo-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: bold;
            color: gold;
            text-shadow: 0 0 10px rgba(255,215,0,0.7);
            opacity: 0;
            transition: all 0.5s;
            z-index: 15;
        }
        
        .combo-indicator.active {
            opacity: 1;
            animation: pulse 0.5s;
        }
        
        .power-up {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            z-index: 5;
        }
        
        .power-up.invincibility {
            background: radial-gradient(circle, #ff0 0%, #f80 100%);
            box-shadow: 0 0 10px #ff0;
        }
        
        .power-up.speed {
            background: radial-gradient(circle, #0ff 0%, #08f 100%);
            box-shadow: 0 0 10px #0ff;
        }
        
        .invincibility-effect {
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,0,0.3) 0%, transparent 70%);
            pointer-events: none;
            z-index: -1;
        }
        
        /* Info Panel */
        .info-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            border: 2px solid #4a5568;
            border-radius: 10px;
            padding: 20px;
            max-width: 600px;
            width: 90%;
            z-index: 150;
            display: none;
        }
        
        .info-panel.active {
            display: block;
        }
        
        .info-panel h2 {
            color: #f6ad55;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #4a5568;
            padding-bottom: 0.5rem;
        }
        
        .info-panel p {
            margin-bottom: 0.5rem;
        }
        
        .info-panel .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        /* Game UI */
        .game-ui {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            z-index: 10;
            pointer-events: none;
        }
        
        .game-ui > div {
            background-color: rgba(0, 0, 0, 0.6);
            padding: 5px 10px;
            border-radius: 5px;
            margin: 0 5px;
            pointer-events: auto;
        }
        
        .game-ui i {
            margin-right: 5px;
        }
        
        /* Level Select */
        .level-select {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }
        
        .level-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .level-card {
            width: 100px;
            height: 100px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .level-card:hover {
            transform: scale(1.05);
            background-color: rgba(255,255,255,0.2);
        }
        
        .level-card i {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .level-card.locked {
            filter: grayscale(1);
            cursor: not-allowed;
        }
        
        /* Ninja Sprite */
        .ninja-sprite {
            width: 64px;
            height: 64px;
            background-image: url('https://i.imgur.com/J3EmWlS.png');
            background-repeat: no-repeat;
            image-rendering: pixelated;
        }
        
        .ninja-idle {
            animation: ninja-idle 0.8s steps(4) infinite;
        }
        
        .ninja-run {
            animation: ninja-run 0.8s steps(6) infinite;
        }
        
        .ninja-jump {
            animation: ninja-jump 0.5s steps(2) infinite;
        }
        
        /* Enemy Sprites */
        .enemy-sprite {
            width: 32px;
            height: 32px;
            background-image: url('https://i.imgur.com/9QZqW3k.png');
            background-repeat: no-repeat;
            image-rendering: pixelated;
        }
        
        .slime-enemy {
            animation: enemy-walk 1s steps(4) infinite;
        }
        
        /* Collectible Sprites */
        .collectible-sprite {
            width: 24px;
            height: 24px;
            background-image: url('https://i.imgur.com/8nLf3Qz.png');
            background-repeat: no-repeat;
            image-rendering: pixelated;
        }
        
        .coin-collectible {
            animation: coin-spin 2s infinite linear;
        }
        
        /* Platform Styles */
        .grass-platform {
            background-image: url('https://i.imgur.com/mX7Tv3P.png');
            background-size: cover;
            border-radius: 8px;
        }
        
        .stone-platform {
            background-image: url('https://i.imgur.com/kVYf3Jj.png');
            background-size: cover;
            border-radius: 4px;
        }
        
        .ice-platform {
            background-image: url('https://i.imgur.com/QZJv9Gc.png');
            background-size: cover;
            border-radius: 8px;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div class="container mx-auto p-4">
        <h1 class="text-4xl font-bold text-center mb-4 text-yellow-300">Ninja Jump Adventure</h1>
        <p class="text-center text-gray-400 mb-6">Created by Geoffroy Streit</p>
        
        <div id="game-container" class="w-full h-96 bg-blue-500 rounded-lg relative mx-auto border-4 border-gray-700">
            <!-- Parallax Background -->
            <div class="parallax-bg" id="parallax-bg"></div>
            <div class="damage-effect"></div>
            
            <!-- Game UI -->
            <div class="game-ui">
                <div class="flex items-center">
                    <span class="text-yellow-300"><i class="fas fa-coins"></i></span>
                    <span id="score">0</span>
                </div>
                <div class="flex items-center">
                    <span class="text-red-400"><i class="fas fa-heart"></i></span>
                    <span id="health">3</span>
                </div>
                <div class="flex items-center">
                    <span class="text-blue-400"><i class="fas fa-gem"></i></span>
                    <span id="gems">0</span>/<span id="total-gems">3</span>
                </div>
                <div class="flex items-center">
                    <span class="text-green-400"><i class="fas fa-stopwatch"></i></span>
                    <span id="timer">60</span>
                </div>
                <div class="flex items-center">
                    <span class="text-purple-400"><i class="fas fa-bolt"></i></span>
                    <span id="combo">0x</span>
                </div>
                <button id="pause-btn" class="bg-gray-800 p-1 rounded-lg hover:bg-gray-700 transition">
                    <i class="fas fa-pause"></i>
                </button>
                <button id="info-btn" class="bg-gray-800 p-1 rounded-lg hover:bg-gray-700 transition">
                    <i class="fas fa-info-circle"></i>
                </button>
                <button id="level-btn" class="bg-gray-800 p-1 rounded-lg hover:bg-gray-700 transition">
                    <i class="fas fa-map"></i>
                </button>
            </div>
            
            <!-- Clouds -->
            <div class="cloud cloud-move" style="width: 60px; height: 30px; top: 50px; left: 100px;"></div>
            <div class="cloud cloud-move" style="width: 80px; height: 40px; top: 80px; left: 300px; animation-delay: 5s;"></div>
            <div class="cloud cloud-move" style="width: 100px; height: 50px; top: 40px; left: 500px; animation-delay: 10s;"></div>
            
            <!-- Player Character -->
            <div id="player-container" class="absolute bottom-8 left-1/4 transform -translate-x-1/2">
                <div id="player" class="ninja-sprite ninja-idle relative">
                    <div class="player-shadow"></div>
                </div>
                <div id="double-jump-indicator" class="double-jump-indicator">
                    DOUBLE JUMP READY!
                </div>
            </div>
            
            <!-- Combo Indicator -->
            <div id="combo-indicator" class="combo-indicator"></div>
            
            <!-- Level 1 Elements -->
            <div id="level-1" class="level-content">
                <!-- Platforms -->
                <div class="platform ground-platform absolute bottom-0 left-0 w-full h-16 bg-green-700"></div>
                
                <div class="platform normal-platform grass-platform absolute w-24 h-8 rounded-lg" style="bottom: 100px; left: 50px;"></div>
                <div class="platform normal-platform grass-platform absolute w-24 h-8 rounded-lg" style="bottom: 180px; left: 200px;"></div>
                <div class="platform normal-platform grass-platform absolute w-24 h-8 rounded-lg" style="bottom: 80px; right: 150px;"></div>
                
                <div class="platform bounce-platform ice-platform absolute w-20 h-6 rounded-lg cursor-pointer" style="bottom: 150px; right: 50px;"></div>
                <div class="platform moving-platform stone-platform absolute w-20 h-6 rounded-lg" style="bottom: 200px; left: 150px;"></div>
                <div class="platform fragile-platform stone-platform absolute w-20 h-6 rounded-lg" style="bottom: 220px; right: 200px;"></div>
                
                <!-- Hidden area -->
                <div class="hidden-area absolute w-32 h-32 bg-yellow-300 rounded-lg" style="bottom: 250px; right: 30px;">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-star text-yellow-600 text-4xl float-animation"></i>
                    </div>
                </div>
                
                <!-- Collectibles -->
                <div class="collectible absolute w-8 h-8 flex items-center justify-center" style="bottom: 70px; left: 70px;">
                    <div class="collectible-sprite coin-collectible"></div>
                </div>
                <div class="collectible absolute w-8 h-8 flex items-center justify-center" style="bottom: 150px; left: 220px;">
                    <div class="collectible-sprite coin-collectible"></div>
                </div>
                <div class="collectible absolute w-8 h-8 flex items-center justify-center" style="bottom: 230px; right: 220px;">
                    <div class="collectible-sprite coin-collectible"></div>
                </div>
                <div class="collectible absolute w-8 h-8 flex items-center justify-center" style="bottom: 260px; right: 50px;">
                    <div class="collectible-sprite coin-collectible"></div>
                </div>
                
                <!-- Power-ups -->
                <div class="power-up invincibility" style="bottom: 120px; left: 300px;">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-shield-alt text-white text-xs"></i>
                    </div>
                </div>
                <div class="power-up speed" style="bottom: 190px; left: 350px;">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-bolt text-white text-xs"></i>
                    </div>
                </div>
                
                <!-- Enemies -->
                <div class="enemy absolute w-10 h-10" style="bottom: 8px; left: 300px;">
                    <div class="enemy-sprite slime-enemy"></div>
                    <div class="absolute top-0 left-0 w-full h-1 bg-gray-300">
                        <div class="enemy-health h-full bg-green-500" style="width: 100%;"></div>
                    </div>
                </div>
                
                <div class="enemy absolute w-10 h-10" style="bottom: 108px; left: 400px;">
                    <div class="enemy-sprite slime-enemy"></div>
                    <div class="absolute top-0 left-0 w-full h-1 bg-gray-300">
                        <div class="enemy-health h-full bg-green-500" style="width: 100%;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Level 2 Elements (initially hidden) -->
            <div id="level-2" class="level-content hidden">
                <!-- Different platform layout for level 2 -->
                <div class="platform ground-platform absolute bottom-0 left-0 w-full h-16 bg-gray-600"></div>
                
                <div class="platform normal-platform stone-platform absolute w-24 h-8 rounded-lg" style="bottom: 120px; left: 50px;"></div>
                <div class="platform normal-platform stone-platform absolute w-24 h-8 rounded-lg" style="bottom: 200px; left: 200px;"></div>
                <div class="platform normal-platform stone-platform absolute w-24 h-8 rounded-lg" style="bottom: 100px; right: 150px;"></div>
                
                <div class="platform bounce-platform ice-platform absolute w-20 h-6 rounded-lg cursor-pointer" style="bottom: 170px; right: 50px;"></div>
                <div class="platform moving-platform ice-platform absolute w-20 h-6 rounded-lg" style="bottom: 220px; left: 150px;"></div>
                <div class="platform fragile-platform stone-platform absolute w-20 h-6 rounded-lg" style="bottom: 240px; right: 200px;"></div>
                
                <!-- Hidden area -->
                <div class="hidden-area absolute w-32 h-32 bg-blue-300 rounded-lg" style="bottom: 270px; right: 30px;">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-star text-blue-600 text-4xl float-animation"></i>
                    </div>
                </div>
                
                <!-- Collectibles -->
                <div class="collectible absolute w-8 h-8 flex items-center justify-center" style="bottom: 90px; left: 70px;">
                    <div class="collectible-sprite coin-collectible"></div>
                </div>
                <div class="collectible absolute w-8 h-8 flex items-center justify-center" style="bottom: 170px; left: 220px;">
                    <div class="collectible-sprite coin-collectible"></div>
                </div>
                <div class="collectible absolute w-8 h-8 flex items-center justify-center" style="bottom: 250px; right: 220px;">
                    <div class="collectible-sprite coin-collectible"></div>
                </div>
                <div class="collectible absolute w-8 h-8 flex items-center justify-center" style="bottom: 280px; right: 50px;">
                    <div class="collectible-sprite coin-collectible"></div>
                </div>
                
                <!-- Power-ups -->
                <div class="power-up invincibility" style="bottom: 140px; left: 300px;">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-shield-alt text-white text-xs"></i>
                    </div>
                </div>
                <div class="power-up speed" style="bottom: 210px; left: 350px;">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-bolt text-white text-xs"></i>
                    </div>
                </div>
                
                <!-- Enemies -->
                <div class="enemy absolute w-10 h-10" style="bottom: 8px; left: 300px;">
                    <div class="enemy-sprite slime-enemy"></div>
                    <div class="absolute top-0 left-0 w-full h-1 bg-gray-300">
                        <div class="enemy-health h-full bg-green-500" style="width: 100%;"></div>
                    </div>
                </div>
                
                <div class="enemy absolute w-10 h-10" style="bottom: 128px; left: 400px;">
                    <div class="enemy-sprite slime-enemy"></div>
                    <div class="absolute top-0 left-0 w-full h-1 bg-gray-300">
                        <div class="enemy-health h-full bg-green-500" style="width: 100%;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Level 3 Elements (initially hidden) -->
            <div id="level-3" class="level-content hidden">
                <!-- Different platform layout for level 3 -->
                <div class="platform ground-platform absolute bottom-0 left-0 w-full h-16 bg-gray-800"></div>
                
                <div class="platform normal-platform stone-platform absolute w-24 h-8 rounded-lg" style="bottom: 140px; left: 50px;"></div>
                <div class="platform normal-platform stone-platform absolute w-24 h-8 rounded-lg" style="bottom: 220px; left: 200px;"></div>
                <div class="platform normal-platform stone-platform absolute w-24 h-8 rounded-lg" style="bottom: 120px; right: 150px;"></div>
                
                <div class="platform bounce-platform ice-platform absolute w-20 h-6 rounded-lg cursor-pointer" style="bottom: 190px; right: 50px;"></div>
                <div class="platform moving-platform ice-platform absolute w-20 h-6 rounded-lg" style="bottom: 240px; left: 150px;"></div>
                <div class="platform fragile-platform stone-platform absolute w-20 h-6 rounded-lg" style="bottom: 260px; right: 200px;"></div>
                
                <!-- Hidden area -->
                <div class="hidden-area absolute w-32 h-32 bg-purple-300 rounded-lg" style="bottom: 290px; right: 30px;">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-star text-purple-600 text-4xl float-animation"></i>
                    </div>
                </div>
                
                <!-- Collectibles -->
                <div class="collectible absolute w-8 h-8 flex items-center justify-center" style="bottom: 110px; left: 70px;">
                    <div class="collectible-sprite coin-collectible"></div>
                </div>
                <div class="collectible absolute w-8 h-8 flex items-center justify-center" style="bottom: 190px; left: 220px;">
                    <div class="collectible-sprite coin-collectible"></div>
                </div>
                <div class="collectible absolute w-8 h-8 flex items-center justify-center" style="bottom: 270px; right: 220px;">
                    <div class="collectible-sprite coin-collectible"></div>
                </div>
                <div class="collectible absolute w-8 h-8 flex items-center justify-center" style="bottom: 300px; right: 50px;">
                    <div class="collectible-sprite coin-collectible"></div>
                </div>
                
                <!-- Power-ups -->
                <div class="power-up invincibility" style="bottom: 160px; left: 300px;">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-shield-alt text-white text-xs"></i>
                    </div>
                </div>
                <div class="power-up speed" style="bottom: 230px; left: 350px;">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-bolt text-white text-xs"></i>
                    </div>
                </div>
                
                <!-- Enemies -->
                <div class="enemy absolute w-10 h-10" style="bottom: 8px; left: 300px;">
                    <div class="enemy-sprite slime-enemy"></div>
                    <div class="absolute top-0 left-0 w-full h-1 bg-gray-300">
                        <div class="enemy-health h-full bg-green-500" style="width: 100%;"></div>
                    </div>
                </div>
                
                <div class="enemy absolute w-10 h-10" style="bottom: 148px; left: 400px;">
                    <div class="enemy-sprite slime-enemy"></div>
                    <div class="absolute top-0 left-0 w-full h-1 bg-gray-300">
                        <div class="enemy-health h-full bg-green-500" style="width: 100%;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Game Over Screen -->
            <div id="game-over" class="absolute inset-0 bg-black bg-opacity-70 flex flex-col items-center justify-center hidden z-100">
                <h2 class="text-4xl font-bold text-red-500 mb-4">Game Over</h2>
                <div class="bg-gray-800 p-6 rounded-lg text-center mb-6">
                    <p class="text-xl mb-2">Your score: <span class="text-yellow-300" id="final-score">0</span></p>
                    <p class="text-xl">Gems collected: <span class="text-blue-300" id="final-gems">0</span>/<span id="final-total-gems">3</span></p>
                    <p class="text-xl mt-2">Max combo: <span class="text-purple-300" id="final-combo">0x</span></p>
                </div>
                <button id="restart-btn" class="px-6 py-2 bg-green-500 rounded-lg hover:bg-green-600 transition flex items-center">
                    <i class="fas fa-redo mr-2"></i> Play Again
                </button>
            </div>
            
            <!-- Victory Screen -->
            <div id="victory" class="absolute inset-0 bg-black bg-opacity-70 flex flex-col items-center justify-center hidden z-100">
                <h2 class="text-4xl font-bold text-yellow-300 mb-4">Victory!</h2>
                <div class="bg-gray-800 p-6 rounded-lg text-center mb-6">
                    <p class="text-xl mb-2">You collected all the gems!</p>
                    <p class="text-xl">Final score: <span class="text-yellow-300" id="victory-score">0</span></p>
                    <p class="text-xl mt-2">Max combo: <span class="text-purple-300" id="victory-combo">0x</span></p>
                </div>
                <button id="victory-restart-btn" class="px-6 py-2 bg-green-500 rounded-lg hover:bg-green-600 transition flex items-center">
                    <i class="fas fa-redo mr-2"></i> Play Again
                </button>
                <button id="next-level-btn" class="px-6 py-2 bg-blue-500 rounded-lg hover:bg-blue-600 transition flex items-center mt-4">
                    <i class="fas fa-arrow-right mr-2"></i> Next Level
                </button>
            </div>
            
            <!-- Pause Screen -->
            <div id="pause-screen" class="pause-screen hidden">
                <h2 class="text-4xl font-bold text-yellow-300 mb-6">Game Paused</h2>
                <button id="resume-btn" class="px-6 py-2 bg-green-500 rounded-lg hover:bg-green-600 transition mb-4">
                    Resume Game
                </button>
                <button id="restart-from-pause-btn" class="px-6 py-2 bg-blue-500 rounded-lg hover:bg-blue-600 transition">
                    Restart Game
                </button>
                <button id="level-select-from-pause-btn" class="px-6 py-2 bg-purple-500 rounded-lg hover:bg-purple-600 transition mt-4">
                    Level Select
                </button>
            </div>
            
            <!-- Tutorial Overlay -->
            <div id="tutorial-overlay" class="tutorial-overlay">
                <div class="bg-gray-800 p-6 rounded-lg max-w-md">
                    <h2 class="text-2xl font-bold text-yellow-300 mb-4">Ninja Jump Adventure</h2>
                    <p class="mb-4">Jump, collect coins and gems, and defeat enemies in this action-packed platformer!</p>
                    
                    <div class="mb-4">
                        <h3 class="text-lg font-semibold mb-2">Controls:</h3>
                        <p class="mb-1"><span class="bg-gray-700 px-2 py-1 rounded">Space</span> - Jump</p>
                        <p class="mb-1"><span class="bg-gray-700 px-2 py-1 rounded">← →</span> - Move</p>
                        <p><span class="bg-gray-700 px-2 py-1 rounded">P</span> - Pause</p>
                    </div>
                    
                    <button id="start-game-btn" class="w-full px-6 py-2 bg-green-500 rounded-lg hover:bg-green-600 transition mt-4">
                        Start Game
                    </button>
                </div>
            </div>
            
            <!-- Level Select Screen -->
            <div id="level-select-screen" class="level-select hidden">
                <h2 class="text-3xl font-bold text-yellow-300 mb-6">Select Level</h2>
                
                <div class="level-grid">
                    <div class="level-card" data-level="1">
                        <i class="fas fa-leaf text-green-400"></i>
                        <span>Forest</span>
                    </div>
                    <div class="level-card" data-level="2">
                        <i class="fas fa-mountain text-blue-400"></i>
                        <span>Mountains</span>
                    </div>
                    <div class="level-card" data-level="3">
                        <i class="fas fa-skull text-gray-400"></i>
                        <span>Dark Cave</span>
                    </div>
                </div>
                
                <button id="back-to-game-btn" class="px-6 py-2 bg-gray-500 rounded-lg hover:bg-gray-600 transition mt-6">
                    Back to Game
                </button>
            </div>
        </div>
        
        <!-- Info Panel (hidden by default) -->
        <div id="info-panel" class="info-panel">
            <button class="close-btn" id="close-info-btn">
                <i class="fas fa-times"></i>
            </button>
            <h2>Game Information</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <h3 class="text-lg font-semibold mb-2">Power-ups:</h3>
                    <div class="flex items-center mb-1">
                        <div class="w-4 h-4 bg-yellow-300 rounded-full mr-2 flex items-center justify-center">
                            <i class="fas fa-coins text-yellow-700 text-xs"></i>
                        </div>
                        <span>Coins (+10 pts)</span>
                    </div>
                    <div class="flex items-center mb-1">
                        <div class="w-4 h-4 bg-blue-300 rounded-full mr-2 flex items-center justify-center">
                            <i class="fas fa-gem text-blue-700 text-xs"></i>
                        </div>
                        <span>Gems (+50 pts, required for victory)</span>
                    </div>
                    <div class="flex items-center mb-1">
                        <div class="w-4 h-4 bg-yellow-500 rounded-full mr-2 flex items-center justify-center">
                            <i class="fas fa-shield-alt text-white text-xs"></i>
                        </div>
                        <span>Invincibility (temporary protection)</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-blue-400 rounded-full mr-2 flex items-center justify-center">
                            <i class="fas fa-bolt text-white text-xs"></i>
                        </div>
                        <span>Speed Boost (faster movement)</span>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-2">Enemies:</h3>
                    <div class="flex items-center mb-1">
                        <div class="w-4 h-4 bg-red-700 rounded mr-2 flex items-center justify-center">
                            <i class="fas fa-bug text-white text-xs"></i>
                        </div>
                        <span>Jump on them to defeat (+30 pts)</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-red-700 rounded mr-2 flex items-center justify-center">
                            <i class="fas fa-ghost text-white text-xs"></i>
                        </div>
                        <span>Contact damages you (-1 health)</span>
                    </div>
                    
                    <h3 class="text-lg font-semibold mt-4 mb-2">Combo System:</h3>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-purple-500 rounded-full mr-2 flex items-center justify-center">
                            <i class="fas fa-bolt text-white text-xs"></i>
                        </div>
                        <span>Chain actions to increase multiplier</span>
                    </div>
                </div>
                
                <div class="md:col-span-2">
                    <h3 class="text-lg font-semibold mb-2">Special:</h3>
                    <div class="flex items-center mb-1">
                        <div class="w-4 h-4 bg-yellow-300 rounded mr-2 flex items-center justify-center">
                            <i class="fas fa-star text-yellow-600 text-xs"></i>
                        </div>
                        <span>Hidden areas (reveal when close)</span>
                    </div>
                    <div class="flex items-center mb-1">
                        <div class="w-4 h-4 bg-white rounded-full mr-2"></div>
                        <span>Double jump when in air</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-red-500 rounded-full mr-2"></div>
                        <span>Time limit (60 seconds)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="jump-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-quick-jump-arcade-game-239.mp3" preload="auto"></audio>
    <audio id="collect-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-coin-win-notification-919.mp3" preload="auto"></audio>
    <audio id="damage-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-player-losing-or-failing-2042.mp3" preload="auto"></audio>
    <audio id="bounce-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3" preload="auto"></audio>
    <audio id="break-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-wood-break-with-hammer-2955.mp3" preload="auto"></audio>
    <audio id="victory-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" preload="auto"></audio>
    <audio id="game-over-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-retro-arcade-lose-2027.mp3" preload="auto"></audio>
    <audio id="powerup-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" preload="auto"></audio>
    <audio id="combo-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-beep-221.mp3" preload="auto"></audio>
    <audio id="background-music" loop src="https://assets.mixkit.co/music/preview/mixkit-game-show-suspense-waiting-668.mp3" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Game state
            const gameState = {
                score: 0,
                health: 3,
                gems: 0,
                timeLeft: 60,
                isJumping: false,
                hasDoubleJump: true,
                isGameOver: false,
                isPaused: false,
                playerVelocityY: 0,
                playerVelocityX: 0,
                gravity: 0.5,
                playerX: 100,
                playerY: 0,
                playerWidth: 48,
                playerHeight: 48,
                keys: {},
                platforms: [],
                collectibles: [],
                enemies: [],
                powerUps: [],
                totalGems: 0,
                particles: [],
                clouds: [],
                bgPos: 0,
                gameStartTime: 0,
                lastTime: 0,
                tutorialShown: true,
                combo: 0,
                maxCombo: 0,
                comboTimeout: null,
                isInvincible: false,
                speedBoost: false,
                speedBoostEndTime: 0,
                invincibilityEndTime: 0,
                currentLevel: 1,
                unlockedLevels: [1]
            };

            // DOM elements
            const player = document.getElementById('player');
            const playerContainer = document.getElementById('player-container');
            const playerShadow = document.querySelector('.player-shadow');
            const gameContainer = document.getElementById('game-container');
            const scoreDisplay = document.getElementById('score');
            const healthDisplay = document.getElementById('health');
            const gemsDisplay = document.getElementById('gems');
            const totalGemsDisplay = document.getElementById('total-gems');
            const timerDisplay = document.getElementById('timer');
            const comboDisplay = document.getElementById('combo');
            const gameOverScreen = document.getElementById('game-over');
            const finalScoreDisplay = document.getElementById('final-score');
            const finalGemsDisplay = document.getElementById('final-gems');
            const finalTotalGemsDisplay = document.getElementById('final-total-gems');
            const finalComboDisplay = document.getElementById('final-combo');
            const restartBtn = document.getElementById('restart-btn');
            const victoryScreen = document.getElementById('victory');
            const victoryScoreDisplay = document.getElementById('victory-score');
            const victoryComboDisplay = document.getElementById('victory-combo');
            const victoryRestartBtn = document.getElementById('victory-restart-btn');
            const nextLevelBtn = document.getElementById('next-level-btn');
            const damageEffect = document.querySelector('.damage-effect');
            const hiddenArea = document.querySelector('.hidden-area');
            const parallaxBg = document.getElementById('parallax-bg');
            const pauseBtn = document.getElementById('pause-btn');
            const pauseScreen = document.getElementById('pause-screen');
            const resumeBtn = document.getElementById('resume-btn');
            const restartFromPauseBtn = document.getElementById('restart-from-pause-btn');
            const levelSelectFromPauseBtn = document.getElementById('level-select-from-pause-btn');
            const tutorialOverlay = document.getElementById('tutorial-overlay');
            const startGameBtn = document.getElementById('start-game-btn');
            const doubleJumpIndicator = document.getElementById('double-jump-indicator');
            const comboIndicator = document.getElementById('combo-indicator');
            const infoBtn = document.getElementById('info-btn');
            const infoPanel = document.getElementById('info-panel');
            const closeInfoBtn = document.getElementById('close-info-btn');
            const levelBtn = document.getElementById('level-btn');
            const levelSelectScreen = document.getElementById('level-select-screen');
            const backToGameBtn = document.getElementById('back-to-game-btn');
            const levelCards = document.querySelectorAll('.level-card');
            
            // Level elements
            const levelContents = {
                1: document.getElementById('level-1'),
                2: document.getElementById('level-2'),
                3: document.getElementById('level-3')
            };
            
            // Audio elements
            const jumpSound = document.getElementById('jump-sound');
            const collectSound = document.getElementById('collect-sound');
            const damageSound = document.getElementById('damage-sound');
            const bounceSound = document.getElementById('bounce-sound');
            const breakSound = document.getElementById('break-sound');
            const victorySound = document.getElementById('victory-sound');
            const gameOverSound = document.getElementById('game-over-sound');
            const powerupSound = document.getElementById('powerup-sound');
            const comboSound = document.getElementById('combo-sound');
            const bgMusic = document.getElementById('background-music');

            // Initialize game elements
            function initGame() {
                // Reset game state
                gameState.score = 0;
                gameState.health = 3;
                gameState.gems = 0;
                gameState.timeLeft = 60;
                gameState.isJumping = false;
                gameState.hasDoubleJump = true;
                gameState.isGameOver = false;
                gameState.isPaused = false;
                gameState.playerVelocityY = 0;
                gameState.playerVelocityX = 0;
                gameState.playerX = 100;
                gameState.playerY = gameContainer.offsetHeight - 56; // Start on ground
                gameState.particles = [];
                gameState.bgPos = 0;
                gameState.gameStartTime = Date.now();
                gameState.lastTime = 0;
                gameState.combo = 0;
                gameState.maxCombo = 0;
                gameState.isInvincible = false;
                gameState.speedBoost = false;
                gameState.speedBoostEndTime = 0;
                gameState.invincibilityEndTime = 0;
                
                // Clear any existing combo timeout
                if (gameState.comboTimeout) {
                    clearTimeout(gameState.comboTimeout);
                    gameState.comboTimeout = null;
                }
                
                // Update displays
                scoreDisplay.textContent = gameState.score;
                healthDisplay.textContent = gameState.health;
                gemsDisplay.textContent = gameState.gems;
                timerDisplay.textContent = gameState.timeLeft;
                comboDisplay.textContent = '0x';
                
                // Hide game over/victory/pause screens
                gameOverScreen.classList.add('hidden');
                victoryScreen.classList.add('hidden');
                pauseScreen.classList.add('hidden');
                levelSelectScreen.classList.add('hidden');
                
                // Reset player position
                playerContainer.style.left = '25%';
                playerContainer.style.bottom = '8px';
                player.classList.remove('jump-animation', 'land-animation');
                
                // Set player animation to idle
                player.className = 'ninja-sprite ninja-idle relative';
                
                // Remove invincibility effect if present
                const invincibilityEffect = player.querySelector('.invincibility-effect');
                if (invincibilityEffect) {
                    invincibilityEffect.remove();
                }
                
                // Hide all levels except current one
                Object.keys(levelContents).forEach(level => {
                    if (parseInt(level) === gameState.currentLevel) {
                        levelContents[level].classList.remove('hidden');
                    } else {
                        levelContents[level].classList.add('hidden');
                    }
                });
                
                // Get all platforms, collectibles, enemies, and power-ups for current level
                const currentLevelElement = levelContents[gameState.currentLevel];
                gameState.platforms = Array.from(currentLevelElement.querySelectorAll('.platform:not(.ground-platform)'));
                gameState.collectibles = Array.from(currentLevelElement.querySelectorAll('.collectible'));
                gameState.enemies = Array.from(currentLevelElement.querySelectorAll('.enemy'));
                gameState.powerUps = Array.from(currentLevelElement.querySelectorAll('.power-up'));
                gameState.totalGems = currentLevelElement.querySelectorAll('.collectible').length;
                gameState.hiddenArea = currentLevelElement.querySelector('.hidden-area');
                
                totalGemsDisplay.textContent = gameState.totalGems;
                finalTotalGemsDisplay.textContent = gameState.totalGems;
                
                // Reset platforms
                gameState.platforms.forEach(platform => {
                    if (platform.classList.contains('fragile-platform')) {
                        platform.style.display = 'block';
                    }
                });
                
                // Reset collectibles
                gameState.collectibles.forEach(collectible => {
                    collectible.style.display = 'flex';
                });
                
                // Reset enemies
                gameState.enemies.forEach(enemy => {
                    enemy.style.display = 'block';
                    enemy.querySelector('.enemy-health').style.width = '100%';
                });
                
                // Reset power-ups
                gameState.powerUps.forEach(powerUp => {
                    powerUp.style.display = 'block';
                });
                
                // Reset hidden area
                if (gameState.hiddenArea) {
                    gameState.hiddenArea.classList.remove('revealed');
                }
                
                // Reset double jump indicator
                doubleJumpIndicator.classList.remove('active');
                
                // Reset combo indicator
                comboIndicator.classList.remove('active');
                comboIndicator.textContent = '';
                
                // Start background music
                bgMusic.currentTime = 0;
                bgMusic.volume = 0.3;
                
                // Clear existing particles
                document.querySelectorAll('.particle').forEach(p => p.remove());
                
                // Start the game loop if not in tutorial
                if (!gameState.tutorialShown) {
                    bgMusic.play();
                    requestAnimationFrame(gameLoop);
                }
            }

            // Change level
            function changeLevel(level) {
                gameState.currentLevel = level;
                initGame();
                requestAnimationFrame(gameLoop);
            }

            // Unlock next level
            function unlockNextLevel() {
                const nextLevel = gameState.currentLevel + 1;
                if (!gameState.unlockedLevels.includes(nextLevel) && nextLevel <= 3) {
                    gameState.unlockedLevels.push(nextLevel);
                    updateLevelSelectScreen();
                }
            }

            // Update level select screen
            function updateLevelSelectScreen() {
                levelCards.forEach(card => {
                    const level = parseInt(card.dataset.level);
                    if (gameState.unlockedLevels.includes(level)) {
                        card.classList.remove('locked');
                    } else {
                        card.classList.add('locked');
                    }
                });
            }

            // Create particles effect
            function createParticles(x, y, color, count = 10) {
                for (let i = 0; i < count; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = `${x}px`;
                    particle.style.top = `${y}px`;
                    particle.style.width = `${Math.random() * 6 + 2}px`;
                    particle.style.height = particle.style.width;
                    particle.style.backgroundColor = color;
                    particle.style.opacity = '0.8';
                    
                    gameContainer.appendChild(particle);
                    
                    gameState.particles.push({
                        element: particle,
                        x: x,
                        y: y,
                        vx: (Math.random() - 0.5) * 8,
                        vy: (Math.random() - 0.5) * 8,
                        life: 30 + Math.random() * 20
                    });
                }
            }

            // Check collision between two elements
            function checkCollision(rect1, rect2) {
                return (
                    rect1.x < rect2.x + rect2.width &&
                    rect1.x + rect1.width > rect2.x &&
                    rect1.y < rect2.y + rect2.height &&
                    rect1.y + rect1.height > rect2.y
                );
            }

            // Get element's bounding box adjusted for game container
            function getGameBoundingBox(element) {
                const containerRect = gameContainer.getBoundingClientRect();
                const elementRect = element.getBoundingClientRect();
                
                return {
                    x: elementRect.left - containerRect.left,
                    y: elementRect.top - containerRect.top,
                    width: elementRect.width,
                    height: elementRect.height
                };
            }

            // Jump function
            function jump() {
                if (!gameState.isGameOver && !gameState.isPaused) {
                    if (!gameState.isJumping) {
                        // Regular jump from ground/platform
                        gameState.isJumping = true;
                        gameState.playerVelocityY = -12;
                        gameState.hasDoubleJump = true;
                        player.className = 'ninja-sprite ninja-jump relative';
                        
                        // Play jump sound
                        jumpSound.currentTime = 0;
                        jumpSound.play();
                        
                        // Create jump particles
                        createParticles(
                            gameState.playerX + gameState.playerWidth/2, 
                            gameState.playerY + gameState.playerHeight, 
                            '#f56565'
                        );
                        
                        // Add to combo
                        addToCombo('Jump');
                    } else if (gameState.hasDoubleJump) {
                        // Double jump in air
                        gameState.playerVelocityY = -12;
                        gameState.hasDoubleJump = false;
                        doubleJumpIndicator.classList.remove('active');
                        
                        // Play jump sound
                        jumpSound.currentTime = 0;
                        jumpSound.play();
                        
                        // Create double jump particles
                        createParticles(
                            gameState.playerX + gameState.playerWidth/2, 
                            gameState.playerY + gameState.playerHeight, 
                            '#ffffff',
                            15
                        );
                        
                        // Add to combo
                        addToCombo('Double Jump');
                    }
                }
            }

            // Add to combo counter
            function addToCombo(action) {
                // Reset combo timeout if it exists
                if (gameState.comboTimeout) {
                    clearTimeout(gameState.comboTimeout);
                }
                
                // Increase combo
                gameState.combo++;
                if (gameState.combo > gameState.maxCombo) {
                    gameState.maxCombo = gameState.combo;
                }
                
                // Update combo display
                comboDisplay.textContent = `${gameState.combo}x`;
                
                // Show combo indicator for special combos
                if (gameState.combo >= 3) {
                    comboIndicator.textContent = `${gameState.combo} COMBO!`;
                    comboIndicator.classList.add('active');
                    
                    // Play combo sound
                    comboSound.currentTime = 0;
                    comboSound.play();
                    
                    setTimeout(() => {
                        comboIndicator.classList.remove('active');
                    }, 1000);
                }
                
                // Set timeout to reset combo if no actions for 2 seconds
                gameState.comboTimeout = setTimeout(() => {
                    gameState.combo = 0;
                    comboDisplay.textContent = '0x';
                    gameState.comboTimeout = null;
                }, 2000);
            }

            // Take damage function
            function takeDamage() {
                if (gameState.isInvincible) return;
                
                gameState.health--;
                healthDisplay.textContent = gameState.health;
                
                // Show damage effect
                damageEffect.classList.add('active');
                setTimeout(() => {
                    damageEffect.classList.remove('active');
                }, 300);
                
                // Play damage sound
                damageSound.currentTime = 0;
                damageSound.play();
                
                // Shake player
                player.classList.add('shake-animation');
                setTimeout(() => {
                    player.classList.remove('shake-animation');
                }, 300);
                
                // Reset combo
                gameState.combo = 0;
                comboDisplay.textContent = '0x';
                
                if (gameState.health <= 0) {
                    gameOver();
                }
            }

            // Collect item function
            function collectItem(item) {
                item.style.display = 'none';
                
                // Check what type of item was collected
                if (item.querySelector('.fa-coins') || item.querySelector('.coin-collectible')) {
                    const points = 10 * (gameState.combo > 0 ? gameState.combo : 1);
                    gameState.score += points;
                    createParticles(
                        parseFloat(item.style.left) + 12, 
                        parseFloat(item.style.top) + 12, 
                        '#f6e05e',
                        15
                    );
                    
                    // Add to combo
                    addToCombo('Coin');
                } else if (item.querySelector('.fa-gem') || item.querySelector('.gem-collectible')) {
                    const points = 50 * (gameState.combo > 0 ? gameState.combo : 1);
                    gameState.score += points;
                    gameState.gems++;
                    createParticles(
                        parseFloat(item.style.left) + 12, 
                        parseFloat(item.style.top) + 12, 
                        '#63b3ed',
                        20
                    );
                    
                    // Add to combo
                    addToCombo('Gem');
                }
                
                scoreDisplay.textContent = gameState.score;
                gemsDisplay.textContent = gameState.gems;
                
                // Play collect sound
                collectSound.currentTime = 0;
                collectSound.play();
                
                // Check for victory condition
                if (gameState.gems >= gameState.totalGems) {
                    victory();
                }
            }

            // Activate power-up function
            function activatePowerUp(powerUp) {
                powerUp.style.display = 'none';
                
                if (powerUp.classList.contains('invincibility')) {
                    gameState.isInvincible = true;
                    gameState.invincibilityEndTime = Date.now() + 10000; // 10 seconds
                    
                    // Add visual effect
                    const effect = document.createElement('div');
                    effect.className = 'invincibility-effect';
                    player.appendChild(effect);
                    
                    // Remove effect after duration
                    setTimeout(() => {
                        if (player.contains(effect)) {
                            effect.remove();
                        }
                        gameState.isInvincible = false;
                    }, 10000);
                    
                    // Add to combo
                    addToCombo('Power-Up');
                } else if (powerUp.classList.contains('speed')) {
                    gameState.speedBoost = true;
                    gameState.speedBoostEndTime = Date.now() + 5000; // 5 seconds
                    
                    // Remove boost after duration
                    setTimeout(() => {
                        gameState.speedBoost = false;
                    }, 5000);
                    
                    // Add to combo
                    addToCombo('Power-Up');
                }
                
                // Play power-up sound
                powerupSound.currentTime = 0;
                powerupSound.play();
                
                // Create power-up particles
                createParticles(
                    parseFloat(powerUp.style.left) + 10, 
                    parseFloat(powerUp.style.top) + 10, 
                    powerUp.classList.contains('invincibility') ? '#f6e05e' : '#63b3ed',
                    20
                );
            }

            // Game over function
            function gameOver() {
                gameState.isGameOver = true;
                finalScoreDisplay.textContent = gameState.score;
                finalGemsDisplay.textContent = gameState.gems;
                finalComboDisplay.textContent = `${gameState.maxCombo}x`;
                gameOverScreen.classList.remove('hidden');
                
                // Hide next level button
                nextLevelBtn.classList.add('hidden');
                
                // Play game over sound
                bgMusic.pause();
                gameOverSound.currentTime = 0;
                gameOverSound.play();
            }

            // Victory function
            function victory() {
                gameState.isGameOver = true;
                victoryScoreDisplay.textContent = gameState.score;
                victoryComboDisplay.textContent = `${gameState.maxCombo}x`;
                victoryScreen.classList.remove('hidden');
                
                // Show next level button if not on last level
                if (gameState.currentLevel < 3) {
                    nextLevelBtn.classList.remove('hidden');
                    unlockNextLevel();
                } else {
                    nextLevelBtn.classList.add('hidden');
                }
                
                // Play victory sound
                bgMusic.pause();
                victorySound.currentTime = 0;
                victorySound.play();
            }

            // Toggle pause function
            function togglePause() {
                gameState.isPaused = !gameState.isPaused;
                
                if (gameState.isPaused) {
                    pauseScreen.classList.remove('hidden');
                    bgMusic.pause();
                } else {
                    pauseScreen.classList.add('hidden');
                    bgMusic.play();
                    gameState.lastTime = performance.now(); // Reset lastTime to prevent large delta
                    requestAnimationFrame(gameLoop);
                }
            }

            // Toggle level select screen
            function toggleLevelSelect() {
                if (levelSelectScreen.classList.contains('hidden')) {
                    levelSelectScreen.classList.remove('hidden');
                    updateLevelSelectScreen();
                    gameState.isPaused = true;
                } else {
                    levelSelectScreen.classList.add('hidden');
                    gameState.isPaused = false;
                    gameState.lastTime = performance.now();
                    requestAnimationFrame(gameLoop);
                }
            }

            // Toggle info panel
            function toggleInfoPanel() {
                if (infoPanel.classList.contains('active')) {
                    infoPanel.classList.remove('active');
                } else {
                    infoPanel.classList.add('active');
                }
            }

            // Update timer function
            function updateTimer() {
                if (gameState.isGameOver || gameState.isPaused) return;
                
                const currentTime = Date.now();
                const elapsedSeconds = Math.floor((currentTime - gameState.gameStartTime) / 1000);
                gameState.timeLeft = Math.max(0, 60 - elapsedSeconds);
                timerDisplay.textContent = gameState.timeLeft;
                
                if (gameState.timeLeft <= 0) {
                    gameOver();
                }
            }

            // Update player shadow based on jump state
            function updatePlayerShadow() {
                if (gameState.isJumping) {
                    const shadowScale = 0.8 + (Math.abs(gameState.playerVelocityY) / 30);
                    const shadowOpacity = 0.3 - (Math.abs(gameState.playerVelocityY) / 40);
                    
                    playerShadow.style.transform = `translateX(-50%) scale(${shadowScale})`;
                    playerShadow.style.opacity = Math.max(0.1, shadowOpacity).toString();
                } else {
                    playerShadow.style.transform = 'translateX(-50%) scale(0.8)';
                    playerShadow.style.opacity = '0.3';
                }
            }

            // Update player animation based on state
            function updatePlayerAnimation() {
                if (gameState.isJumping) {
                    if (!player.className.includes('ninja-jump')) {
                        player.className = 'ninja-sprite ninja-jump relative';
                    }
                } else if (Math.abs(gameState.playerVelocityX) > 0) {
                    if (!player.className.includes('ninja-run')) {
                        player.className = 'ninja-sprite ninja-run relative';
                    }
                } else {
                    if (!player.className.includes('ninja-idle')) {
                        player.className = 'ninja-sprite ninja-idle relative';
                    }
                }
            }

            // Check and update power-up timers
            function updatePowerUpTimers() {
                const now = Date.now();
                
                // Check invincibility
                if (gameState.isInvincible && now >= gameState.invincibilityEndTime) {
                    gameState.isInvincible = false;
                    const effect = player.querySelector('.invincibility-effect');
                    if (effect) effect.remove();
                }
                
                // Check speed boost
                if (gameState.speedBoost && now >= gameState.speedBoostEndTime) {
                    gameState.speedBoost = false;
                }
            }

            // Main game loop
            function gameLoop(timestamp) {
                if (gameState.isGameOver || gameState.isPaused) return;
                
                // Calculate delta time for smooth animation
                const deltaTime = timestamp - gameState.lastTime;
                gameState.lastTime = timestamp;
                
                // Apply gravity (positive value makes player fall DOWN)
                gameState.playerVelocityY += gameState.gravity;
                
                // Apply horizontal movement based on key presses
                const speedMultiplier = gameState.speedBoost ? 1.5 : 1;
                if (gameState.keys['ArrowLeft']) {
                    gameState.playerVelocityX = -5 * speedMultiplier;
                    player.style.transform = 'scaleX(-1)';
                } else if (gameState.keys['ArrowRight']) {
                    gameState.playerVelocityX = 5 * speedMultiplier;
                    player.style.transform = 'scaleX(1)';
                } else {
                    gameState.playerVelocityX = 0;
                }
                
                // Update player position
                gameState.playerX += gameState.playerVelocityX;
                gameState.playerY += gameState.playerVelocityY;
                
                // Boundary checks
                if (gameState.playerX < 0) {
                    gameState.playerX = 0;
                }
                
                if (gameState.playerX > gameContainer.offsetWidth - gameState.playerWidth) {
                    gameState.playerX = gameContainer.offsetWidth - gameState.playerWidth;
                }
                
                // Ground check (playerY increases as player falls down)
                const groundLevel = gameContainer.offsetHeight - gameState.playerHeight - 8;
                if (gameState.playerY >= groundLevel) {
                    gameState.playerY = groundLevel;
                    gameState.playerVelocityY = 0;
                    gameState.isJumping = false;
                    gameState.hasDoubleJump = true;
                    
                    // Show double jump indicator when landing
                    if (!doubleJumpIndicator.classList.contains('active')) {
                        doubleJumpIndicator.classList.add('active');
                        setTimeout(() => {
                            doubleJumpIndicator.classList.remove('active');
                        }, 2000);
                    }
                }
                
                // Update player position in DOM (using top instead of bottom)
                playerContainer.style.left = `${gameState.playerX}px`;
                playerContainer.style.bottom = `${gameContainer.offsetHeight - gameState.playerY - gameState.playerHeight}px`;
                
                // Update parallax background
                gameState.bgPos = (gameState.bgPos - gameState.playerVelocityX * 0.1) % gameContainer.offsetWidth;
                parallaxBg.style.left = `${gameState.bgPos}px`;
                
                // Update player shadow
                updatePlayerShadow();
                
                // Update player animation
                updatePlayerAnimation();
                
                // Update power-up timers
                updatePowerUpTimers();
                
                // Get player's bounding box
                const playerBox = {
                    x: gameState.playerX,
                    y: gameState.playerY,
                    width: gameState.playerWidth,
                    height: gameState.playerHeight
                };
                
                // Check platform collisions
                let onPlatform = false;
                
                gameState.platforms.forEach(platform => {
                    if (platform.style.display === 'none') return;
                    
                    const platformBox = getGameBoundingBox(platform);
                    
                    // Check if player is above platform and falling
                    if (
                        playerBox.y + playerBox.height > platformBox.y &&
                        playerBox.y < platformBox.y + platformBox.height &&
                        playerBox.x + playerBox.width > platformBox.x &&
                        playerBox.x < platformBox.x + platformBox.width &&
                        gameState.playerVelocityY > 0
                    ) {
                        // Land on platform
                        gameState.playerY = platformBox.y - gameState.playerHeight;
                        gameState.playerVelocityY = 0;
                        gameState.isJumping = false;
                        gameState.hasDoubleJump = true;
                        onPlatform = true;
                        
                        // Show double jump indicator when landing on platform
                        if (!doubleJumpIndicator.classList.contains('active')) {
                            doubleJumpIndicator.classList.add('active');
                            setTimeout(() => {
                                doubleJumpIndicator.classList.remove('active');
                            }, 2000);
                        }
                        
                        // Add landing animation
                        player.classList.add('land-animation');
                        setTimeout(() => {
                            player.classList.remove('land-animation');
                        }, 200);
                        
                        // Platform type specific behaviors
                        if (platform.classList.contains('bounce-platform')) {
                            // Higher bounce
                            gameState.playerVelocityY = -15;
                            gameState.isJumping = true;
                            
                            // Play bounce sound
                            bounceSound.currentTime = 0;
                            bounceSound.play();
                            
                            // Create bounce particles
                            createParticles(
                                gameState.playerX + gameState.playerWidth/2, 
                                gameState.playerY + gameState.playerHeight, 
                                '#4299e1'
                            );
                            
                            // Add to combo
                            addToCombo('Bounce');
                        } else if (platform.classList.contains('fragile-platform')) {
                            // Break after landing
                            setTimeout(() => {
                                platform.style.display = 'none';
                                
                                // Play break sound
                                breakSound.currentTime = 0;
                                breakSound.play();
                                
                                // Create break particles
                                createParticles(
                                    platformBox.x + platformBox.width/2, 
                                    platformBox.y + platformBox.height/2, 
                                    '#ecc94b',
                                    15
                                );
                                
                                // Add to combo
                                addToCombo('Break');
                            }, 200);
                        } else if (platform.classList.contains('moving-platform')) {
                            // Move player with platform
                            gameState.playerX += Math.sin(Date.now() / 500) * 0.5;
                        }
                    }
                });
                
                // Check collectible collisions
                gameState.collectibles.forEach(collectible => {
                    if (collectible.style.display !== 'none') {
                        const collectibleBox = getGameBoundingBox(collectible);
                        
                        if (checkCollision(playerBox, collectibleBox)) {
                            collectItem(collectible);
                        }
                    }
                });
                
                // Check power-up collisions
                gameState.powerUps.forEach(powerUp => {
                    if (powerUp.style.display !== 'none') {
                        const powerUpBox = getGameBoundingBox(powerUp);
                        
                        if (checkCollision(playerBox, powerUpBox)) {
                            activatePowerUp(powerUp);
                        }
                    }
                });
                
                // Check enemy collisions
                gameState.enemies.forEach(enemy => {
                    if (enemy.style.display !== 'none') {
                        const enemyBox = getGameBoundingBox(enemy);
                        
                        if (checkCollision(playerBox, enemyBox)) {
                            // Check if player is jumping on enemy (from above)
                            if (gameState.playerVelocityY > 0 && playerBox.y + playerBox.height < enemyBox.y + 20) {
                                // Enemy defeated
                                const healthBar = enemy.querySelector('.enemy-health');
                                const currentWidth = parseFloat(healthBar.style.width);
                                const newWidth = currentWidth - 50;
                                
                                if (newWidth <= 0) {
                                    enemy.style.display = 'none';
                                    const points = 30 * (gameState.combo > 0 ? gameState.combo : 1);
                                    gameState.score += points;
                                    scoreDisplay.textContent = gameState.score;
                                    
                                    // Create enemy defeat particles
                                    createParticles(
                                        enemyBox.x + enemyBox.width/2, 
                                        enemyBox.y + enemyBox.height/2, 
                                        '#f56565',
                                        20
                                    );
                                    
                                    // Add to combo
                                    addToCombo('Enemy Defeat');
                                } else {
                                    healthBar.style.width = `${newWidth}%`;
                                }
                                
                                // Bounce off enemy
                                gameState.playerVelocityY = -10;
                            } else if (!gameState.isInvincible) {
                                // Player takes damage
                                takeDamage();
                                
                                // Knockback
                                gameState.playerVelocityX = playerBox.x < enemyBox.x ? -8 : 8;
                                gameState.playerVelocityY = -5;
                            }
                        }
                    }
                });
                
                // Check hidden area proximity
                if (gameState
</html>